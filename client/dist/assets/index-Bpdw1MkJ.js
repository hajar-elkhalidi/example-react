import{c as Vs,j as e,$ as os,O as Hs,T as Gs,t as Ws,a as Zs,S as Ys,b as fe,r as l,R as is,d as J,u as ls,L as g,A as W,e as cs,p as Xs,_ as et,f as L,g as D,h as te,i as st,H as ds,U as tt,k as Fe,l as H,m as pe,P as ms,C as ne,X as $e,n as at,o as Ie,q as nt,s as Z,v as us,I as hs,F as xs,w as rt,x as gs,y as ot,z as it,B as lt,D as fs,E as ct,G as ps,J as dt,K as js,M as ys,N as mt,Q as ut,V as ht,W as xt,Y as gt,Z as ft,a0 as Ye,a1 as pt,a2 as jt,a3 as yt,a4 as vt,a5 as vs,a6 as Nt,a7 as Ns,a8 as je,a9 as bs,aa as bt,ab as ws,ac as wt,ad as Rs,ae as ks,af as Cs,ag as Ss,ah as Ts,ai as Rt,aj as Ls,ak as Ps,al as kt,am as Ct,an as St,ao as Tt,ap as Lt,aq as Pt,ar as Ut,as as At,at as Et,au as Dt,av as Mt,aw as Ft,ax as $t,ay as ke,az as Ce,aA as It,aB as Ot,aC as qt,aD as zt,aE as Us,aF as Bt,aG as Se,aH as Qt,aI as Te,aJ as Xe,aK as Kt,aL as _t,aM as Jt,aN as As,aO as Es,aP as Vt,aQ as Ht,aR as Re,aS as es,aT as Gt,aU as Wt,aV as Zt,aW as Yt,aX as Xt,aY as ea,aZ as sa,a_ as ta,a$ as aa,b0 as na,b1 as ra,b2 as oa,b3 as ia}from"./vendor-DMpUmzNC.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function t(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(r){if(r.ep)return;r.ep=!0;const o=t(r);fetch(r.href,o)}})();const _=Vs({component:()=>e.jsxs(os.Fragment,{children:[e.jsx(Hs,{}),e.jsx(Gs,{})]})});function x(...a){return Ws(Zs(a))}const Oe=fe("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function m({className:a,variant:s,size:t,asChild:n=!1,...r}){const o=n?Ys:"button";return e.jsx(o,{"data-slot":"button",className:x(Oe({variant:s,size:t,className:a})),...r})}const q=l.forwardRef(({className:a,...s},t)=>e.jsx("div",{ref:t,className:x("rounded-xl border bg-card text-card-foreground shadow",a),...s}));q.displayName="Card";const Q=l.forwardRef(({className:a,...s},t)=>e.jsx("div",{ref:t,className:x("flex flex-col space-y-1.5 p-6",a),...s}));Q.displayName="CardHeader";const K=l.forwardRef(({className:a,...s},t)=>e.jsx("div",{ref:t,className:x("font-semibold leading-none tracking-tight",a),...s}));K.displayName="CardTitle";const G=l.forwardRef(({className:a,...s},t)=>e.jsx("div",{ref:t,className:x("text-sm text-muted-foreground",a),...s}));G.displayName="CardDescription";const z=l.forwardRef(({className:a,...s},t)=>e.jsx("div",{ref:t,className:x("p-6 pt-0",a),...s}));z.displayName="CardContent";const la=l.forwardRef(({className:a,...s},t)=>e.jsx("div",{ref:t,className:x("flex items-center p-6 pt-0",a),...s}));la.displayName="CardFooter";const U=l.forwardRef(({className:a,type:s,...t},n)=>e.jsx("input",{type:s,className:x("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:n,...t}));U.displayName="Input";const ca=fe("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),A=l.forwardRef(({className:a,...s},t)=>e.jsx(is,{ref:t,className:x(ca(),a),...s}));A.displayName=is.displayName;const da=J("/verify-otp")({component:ma,validateSearch:a=>({e:a.e||""})});function ma(){const a=ls({from:"/verify-otp"}),[s,t]=l.useState(""),n=()=>{console.log("Verifying OTP:",s,"for email:",a.e)};return e.jsxs("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 relative",children:[e.jsx(g,{to:"/forgot-password",className:"absolute top-4 left-4",children:e.jsxs(m,{variant:"ghost",size:"sm",children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),"Back"]})}),e.jsxs(q,{className:"w-full max-w-md",children:[e.jsxs(Q,{className:"text-center",children:[e.jsx(K,{className:"text-2xl",children:"Verify OTP"}),e.jsxs(G,{children:["Enter the 6-digit code sent to ",a.e||"your email"]})]}),e.jsxs(z,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"otp",children:"OTP Code"}),e.jsx(U,{id:"otp",type:"text",placeholder:"Enter 6-digit code",value:s,onChange:r=>t(r.target.value),maxLength:6,className:"text-center text-lg tracking-widest",required:!0})]}),e.jsx(m,{className:"w-full",onClick:n,disabled:s.length!==6,children:"Verify OTP"}),e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx(g,{to:"/forgot-password",className:"text-sm text-blue-600 hover:underline",children:"Resend Code"}),e.jsx("div",{children:e.jsx(g,{to:"/login",search:{redirect:"/"},className:"text-sm text-blue-600 hover:underline",children:"Back to Sign In"})})]})]})]})]})}const S=cs()(Xs((a,s)=>({user:null,isAuthenticated:!1,tokens:null,setUser:t=>{a({user:t})},setAuthenticated:t=>{a({isAuthenticated:t})},setTokens:t=>{a({tokens:t})},logout:()=>{a({user:null,isAuthenticated:!1,tokens:null})},login:async(t,n)=>(await new Promise(r=>setTimeout(r,1e3)),t==="demo@example.com"&&n==="password"?(a({user:{id:"1",name:"Demo User",email:"demo@example.com",avatar:"/api/placeholder/120/120"},isAuthenticated:!0}),!0):!1),register:async(t,n,r)=>{await new Promise(i=>setTimeout(i,1e3));const o={id:Date.now().toString(),name:t,email:n,avatar:"/api/placeholder/120/120"};return a({user:o,isAuthenticated:!0}),!0}}),{name:"auth-storage",partialize:a=>({user:a.user,isAuthenticated:a.isAuthenticated,tokens:a.tokens})})),ua=Object.freeze(Object.defineProperty({__proto__:null,useAuthStore:S},Symbol.toStringTag,{value:"Module"})),ha=()=>"8080",xa=()=>"5173",ga=()=>"/api",fa=()=>typeof window<"u"?window.location.origin:"",Le={serverPort:ha(),clientPort:xa(),apiBaseUrl:ga(),socketUrl:fa(),appName:"Todo App",appVersion:"1.0.0",isDevelopment:!1,isProduction:!0};class pa{baseURL;accessToken=null;refreshToken=null;refreshAttempts=0;maxRefreshAttempts=3;constructor(s=Le.apiBaseUrl){this.baseURL=s,this.loadTokensFromStorage(),console.log("HTTP Client initialized:",{baseURL:this.baseURL,hasAccessToken:!!this.accessToken,hasRefreshToken:!!this.refreshToken})}loadTokensFromStorage(){try{const s=localStorage.getItem("auth-storage");if(s){const t=JSON.parse(s),n=t.state?.tokens||t.tokens;this.accessToken=n?.accessToken||null,this.refreshToken=n?.refreshToken||null,console.log("Loading tokens from storage:",{hasAuthData:!!s,hasState:!!t.state,hasTokens:!!n,hasAccessToken:!!this.accessToken})}}catch(s){console.warn("Failed to load tokens from storage:",s)}}saveTokensToStorage(s,t){this.accessToken=s,this.refreshToken=t,this.refreshAttempts=0;try{let n=localStorage.getItem("auth-storage"),r;n?r=JSON.parse(n):r={state:{user:null,isAuthenticated:!1,tokens:null},version:0},r.state||(r.state={}),r.state.tokens={accessToken:s,refreshToken:t},s&&(r.state.isAuthenticated=!0),localStorage.setItem("auth-storage",JSON.stringify(r)),console.log("Saved tokens to localStorage:",{hasAccessToken:!!s,hasRefreshToken:!!t,accessTokenPreview:s?`${s.substring(0,20)}...`:null,fullStructure:r});const o=localStorage.getItem("auth-storage");if(o){const i=JSON.parse(o);console.log("Verification - tokens in storage:",{hasTokens:!!i.state?.tokens,hasAccessToken:!!i.state?.tokens?.accessToken})}}catch(n){console.error("Failed to save tokens to storage:",n)}}clearTokens(){this.accessToken=null,this.refreshToken=null,this.refreshAttempts=0;try{const s=localStorage.getItem("auth-storage");if(s){const t=JSON.parse(s);delete t.state.tokens,localStorage.setItem("auth-storage",JSON.stringify(t))}}catch(s){console.warn("Failed to clear tokens from storage:",s)}}syncTokensFromAuthStore(){try{const s=localStorage.getItem("auth-storage");if(s){const n=JSON.parse(s).state?.tokens;if(n?.accessToken&&n?.refreshToken)return this.accessToken=n.accessToken,this.refreshToken=n.refreshToken,console.log("Synced tokens from authStore:",{hasAccessToken:!!this.accessToken,accessTokenLength:this.accessToken?.length}),!0}}catch(s){console.warn("Failed to sync tokens from authStore:",s)}return!1}async request(s,t={}){this.accessToken||this.syncTokensFromAuthStore();const n=`${this.baseURL}${s}`,r={"Content-Type":"application/json",...t.headers};this.accessToken?(r.Authorization=`Bearer ${this.accessToken}`,console.log("Adding Authorization header:",`Bearer ${this.accessToken.substring(0,20)}...`)):console.warn("No access token available for request to:",s),console.log("this.accessToken",this.accessToken);try{const o=await fetch(n,{...t,headers:r}),i=await o.json();if(!o.ok){if(o.status===401&&this.refreshToken&&s!=="/auth/refresh"&&this.refreshAttempts<this.maxRefreshAttempts)try{return this.refreshAttempts++,console.log(`Attempting token refresh (${this.refreshAttempts}/${this.maxRefreshAttempts})`),await this.refreshAccessToken(),this.request(s,t)}catch(c){throw console.error(`Token refresh failed (attempt ${this.refreshAttempts}):`,c),this.refreshAttempts>=this.maxRefreshAttempts&&(console.log("Max refresh attempts reached, logging out user"),this.handleAuthFailure()),new xe("Session expired. Please login again.",401)}else o.status===401&&this.handleAuthFailure();throw new xe(i.message||`HTTP ${o.status}: ${o.statusText}`,o.status,i.errors)}return i}catch(o){throw o instanceof xe?o:new xe(o instanceof Error?o.message:"Network error occurred",0)}}handleAuthFailure(){console.log("Authentication failed, clearing tokens and redirecting to login"),this.clearTokens();try{et(async()=>{const{useAuthStore:s}=await Promise.resolve().then(()=>ua);return{useAuthStore:s}},void 0).then(({useAuthStore:s})=>{s.getState().logout()})}catch(s){console.warn("Failed to clear auth store:",s),localStorage.removeItem("auth-storage")}if(typeof window<"u"&&window.location.pathname!=="/login"){const s=window.location.pathname+window.location.search;window.location.href=`/login?redirect=${encodeURIComponent(s)}`}}async refreshAccessToken(){if(!this.refreshToken)throw new Error("No refresh token available");try{const s=await fetch(`${this.baseURL}/auth/refresh`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:this.refreshToken})});if(!s.ok)throw new Error(`Failed to refresh token: ${s.status}`);const t=await s.json();if(!t.success||!t.data?.tokens)throw new Error("Invalid refresh token response");const{accessToken:n,refreshToken:r}=t.data.tokens;this.saveTokensToStorage(n,r)}catch(s){throw this.clearTokens(),s}}async get(s){return this.request(s,{method:"GET"})}async post(s,t){return this.request(s,{method:"POST",body:t?JSON.stringify(t):void 0})}async put(s,t){return this.request(s,{method:"PUT",body:t?JSON.stringify(t):void 0})}async delete(s){return this.request(s,{method:"DELETE"})}setTokens(s,t){this.saveTokensToStorage(s,t)}reloadTokens(){this.loadTokensFromStorage()}forceSetTokens(s,t){console.log("Force setting tokens:",{hasAccessToken:!!s,hasRefreshToken:!!t}),this.accessToken=s,this.refreshToken=t}clearAuth(){this.clearTokens()}}class xe extends Error{constructor(s,t,n){super(s),this.status=t,this.errors=n,this.name="ApiError"}}const v=new pa;class ja{async login(s){const t=await v.post("/auth/login",s);if(t.success&&t.data)return console.log("Login successful, storing tokens:",{hasAccessToken:!!t.data.tokens.accessToken,hasRefreshToken:!!t.data.tokens.refreshToken,accessTokenLength:t.data.tokens.accessToken?.length}),v.setTokens(t.data.tokens.accessToken,t.data.tokens.refreshToken),t.data;throw new Error(t.message||"Login failed")}async register(s){const t=await v.post("/auth/register",s);if(t.success&&t.data)return v.setTokens(t.data.tokens.accessToken,t.data.tokens.refreshToken),t.data;throw new Error(t.message||"Registration failed")}async logout(){try{await v.post("/auth/logout")}catch(s){console.warn("Logout request failed:",s)}finally{v.clearAuth()}}async getCurrentUser(){const s=await v.get("/auth/me");if(s.success&&s.data)return s.data;throw new Error(s.message||"Failed to get user profile")}async forgotPassword(s){const t=await v.post("/auth/forgot-password",s);if(t.success&&t.data)return t.data;throw new Error(t.message||"Failed to send reset email")}async verifyOtp(s){const t=await v.post("/auth/verify-otp",s);if(!t.success)throw new Error(t.message||"OTP verification failed")}async resetPassword(s){const t=await v.post("/auth/reset-password",s);if(!t.success)throw new Error(t.message||"Password reset failed")}async changePassword(s){const t=await v.post("/auth/change-password",s);if(!t.success)throw new Error(t.message||"Password change failed")}isAuthenticated(){try{const s=localStorage.getItem("auth-storage");if(s){const t=JSON.parse(s);return t.state?.isAuthenticated===!0&&!!t.state?.tokens?.accessToken}}catch(s){console.warn("Failed to check authentication status:",s)}return!1}async updateProfile(s){const t=await v.put("/auth/profile",s);if(t.success&&t.data)return t.data.user;throw new Error(t.message||"Failed to update profile")}}const re=new ja,V={all:["auth"],me:()=>[...V.all,"me"]},ya=()=>{const{isAuthenticated:a}=S();return te({queryKey:V.me(),queryFn:re.getCurrentUser,enabled:a,staleTime:5*60*1e3,retry:(s,t)=>t?.status===401?!1:s<3})},va=()=>{const a=L(),{setUser:s,setAuthenticated:t,setTokens:n}=S();return D({mutationFn:r=>re.login(r),onSuccess:r=>{console.log("Login mutation onSuccess, received data:",{hasUser:!!r.user,hasTokens:!!r.tokens,accessTokenLength:r.tokens?.accessToken?.length}),s({id:r.user.id,name:r.user.username,email:r.user.email,avatar:r.user.avatarUrl}),t(!0),n(r.tokens),v.forceSetTokens(r.tokens.accessToken,r.tokens.refreshToken),v.setTokens(r.tokens.accessToken,r.tokens.refreshToken),a.setQueryData(V.me(),r.user),a.invalidateQueries({queryKey:V.all})},onError:r=>{console.error("Login failed:",r)}})},Na=()=>{const a=L(),{setUser:s,setAuthenticated:t,setTokens:n}=S();return D({mutationFn:r=>re.register(r),onSuccess:r=>{s({id:r.user.id,name:r.user.username,email:r.user.email,avatar:r.user.avatarUrl}),t(!0),n(r.tokens),a.setQueryData(V.me(),r.user),a.invalidateQueries({queryKey:V.all})},onError:r=>{console.error("Registration failed:",r)}})},ba=()=>{const a=L(),{setUser:s}=S();return D({mutationFn:t=>re.updateProfile(t),onSuccess:t=>{s({id:t.id,name:t.username,email:t.email,avatar:t.avatarUrl}),a.setQueryData(V.me(),t),a.invalidateQueries({queryKey:V.all})},onError:t=>{console.error("Profile update failed:",t)}})},Ds=()=>{const a=L(),{logout:s}=S();return D({mutationFn:re.logout,onSuccess:()=>{s(),a.clear()},onError:t=>{console.error("Logout failed:",t),s(),a.clear()}})};function se({showBackButton:a=!1,title:s,transparent:t=!1}){const n=st(),{isAuthenticated:r,user:o}=S(),i=Ds(),c=f=>n.pathname===f,d=()=>{i.mutate()};return e.jsxs("nav",{className:`${t?"bg-white/95 backdrop-blur-sm":"bg-white"} shadow-sm border-b sticky top-0 z-50`,children:[e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center h-16",children:[e.jsxs("div",{className:"flex items-center",children:[a&&e.jsx(g,{to:"/",className:"mr-4",children:e.jsxs(m,{variant:"ghost",size:"sm",children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),"Back"]})}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-sm",children:"MS"})})}),e.jsx("div",{className:"ml-3",children:e.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:s||"MERN Stack"})})]})]}),e.jsx("div",{className:"hidden md:block",children:e.jsxs("div",{className:"ml-10 flex items-baseline space-x-4",children:[e.jsxs(g,{to:"/",className:`px-3 py-2 rounded-md text-sm font-medium transition-colors ${c("/")?"text-blue-600 bg-blue-50":"text-gray-600 hover:text-blue-600"}`,children:[e.jsx(ds,{className:"w-4 h-4 inline mr-1"}),"Home"]}),e.jsx(g,{to:"/todo",className:`px-3 py-2 rounded-md text-sm font-medium transition-colors ${c("/todo")?"text-blue-600 bg-blue-50":"text-gray-600 hover:text-blue-600"}`,children:"Todo"}),e.jsx(g,{to:"/chat",className:`px-3 py-2 rounded-md text-sm font-medium transition-colors ${c("/chat")?"text-blue-600 bg-blue-50":"text-gray-600 hover:text-blue-600"}`,children:"Chat"}),e.jsx(g,{to:"/profile",className:`px-3 py-2 rounded-md text-sm font-medium transition-colors ${c("/profile")?"text-blue-600 bg-blue-50":"text-gray-600 hover:text-blue-600"}`,children:"Profile"})]})}),e.jsx("div",{className:"flex items-center space-x-4",children:r?e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:["Welcome, ",o?.name]}),e.jsx(g,{to:"/profile",children:e.jsxs(m,{variant:"outline",size:"sm",children:[e.jsx(tt,{className:"w-4 h-4 mr-2"}),"Profile"]})}),e.jsxs(m,{variant:"outline",size:"sm",onClick:d,disabled:i.isPending,children:[e.jsx(Fe,{className:"w-4 h-4 mr-2"}),i.isPending?"Signing Out...":"Sign Out"]})]}):e.jsxs(e.Fragment,{children:[e.jsx(g,{to:"/login",search:{redirect:"/"},children:e.jsx(m,{variant:"outline",size:"sm",children:"Sign In"})}),e.jsx(g,{to:"/register",children:e.jsx(m,{size:"sm",children:"Get Started"})})]})})]})}),e.jsx("div",{className:"md:hidden",children:e.jsxs("div",{className:"px-2 pt-2 pb-3 space-y-1 sm:px-3 border-t",children:[e.jsx(g,{to:"/",className:`block px-3 py-2 rounded-md text-base font-medium transition-colors ${c("/")?"text-blue-600 bg-blue-50":"text-gray-600 hover:text-blue-600"}`,children:"Home"}),e.jsx(g,{to:"/todo",className:`block px-3 py-2 rounded-md text-base font-medium transition-colors ${c("/todo")?"text-blue-600 bg-blue-50":"text-gray-600 hover:text-blue-600"}`,children:"Todo"}),e.jsx(g,{to:"/chat",className:`block px-3 py-2 rounded-md text-base font-medium transition-colors ${c("/chat")?"text-blue-600 bg-blue-50":"text-gray-600 hover:text-blue-600"}`,children:"Chat"}),e.jsx(g,{to:"/profile",className:`block px-3 py-2 rounded-md text-base font-medium transition-colors ${c("/profile")?"text-blue-600 bg-blue-50":"text-gray-600 hover:text-blue-600"}`,children:"Profile"})]})})]})}class wa{async getTodos(s){const t=new URLSearchParams;s?.page&&t.append("page",s.page.toString()),s?.limit&&t.append("limit",s.limit.toString()),s?.status&&t.append("status",s.status),s?.sortBy&&t.append("sortBy",s.sortBy),s?.sortOrder&&t.append("sortOrder",s.sortOrder);const n=t.toString(),r=`/todos${n?`?${n}`:""}`,o=await v.get(r);if(o.success&&o.data)return o.data;throw new Error(o.message||"Failed to fetch todos")}async getTodoById(s){const t=await v.get(`/todos/${s}`);if(t.success&&t.data)return t.data;throw new Error(t.message||"Failed to fetch todo")}async createTodo(s){const t=await v.post("/todos",s);if(t.success&&t.data)return t.data.todo;throw new Error(t.message||"Failed to create todo")}async updateTodo(s,t){const n=await v.put(`/todos/${s}`,t);if(n.success&&n.data)return n.data.todo;throw new Error(n.message||"Failed to update todo")}async updateTodoStatus(s,t){const n=await v.put(`/todos/${s}`,t);if(n.success&&n.data)return n.data.todo;throw new Error(n.message||"Failed to update todo status")}async deleteTodo(s){const t=await v.delete(`/todos/${s}`);if(!t.success)throw new Error(t.message||"Failed to delete todo")}}const oe=new wa,I={all:["todos"],lists:()=>[...I.all,"list"],list:a=>[...I.lists(),a],details:()=>[...I.all,"detail"],detail:a=>[...I.details(),a]},Ra=a=>te({queryKey:I.list(a),queryFn:()=>oe.getTodos(a),staleTime:30*1e3,retry:(s,t)=>t?.status===401?!1:s<3}),ka=()=>{const a=L();return D({mutationFn:s=>oe.createTodo(s),onSuccess:s=>{a.invalidateQueries({queryKey:I.lists()}),a.setQueryData(I.detail(s.id),s)},onError:s=>{console.error("Failed to create todo:",s)}})},Ca=()=>{const a=L();return D({mutationFn:({id:s,data:t})=>oe.updateTodo(s,t),onSuccess:s=>{a.setQueryData(I.detail(s.id),s),a.invalidateQueries({queryKey:I.lists()})},onError:s=>{console.error("Failed to update todo:",s)}})},Sa=()=>{const a=L();return D({mutationFn:({id:s,data:t})=>oe.updateTodoStatus(s,t),onSuccess:s=>{a.setQueryData(I.detail(s.id),s),a.invalidateQueries({queryKey:I.lists()})},onError:s=>{console.error("Failed to update todo status:",s)}})},Ta=()=>{const a=L();return D({mutationFn:s=>oe.deleteTodo(s),onSuccess:(s,t)=>{a.removeQueries({queryKey:I.detail(t)}),a.invalidateQueries({queryKey:I.lists()})},onError:s=>{console.error("Failed to delete todo:",s)}})};var B=(a=>(a.INITIAL="initial",a.IN_PROGRESS="in_progress",a.COMPLETED="completed",a.CANCELLED="cancelled",a))(B||{});const La=({size:a="md",className:s})=>{const t={sm:"w-4 h-4",md:"w-6 h-6",lg:"w-8 h-8"};return e.jsx(H,{className:x("animate-spin",t[a],s)})},Pa=({message:a="Loading...",size:s="md",className:t})=>e.jsxs("div",{className:x("flex items-center justify-center py-8",t),children:[e.jsx(La,{size:s}),e.jsx("span",{className:"ml-2 text-gray-600",children:a})]}),Ua=({message:a="Something went wrong",error:s,onRetry:t,className:n})=>e.jsxs("div",{className:x("text-center py-8 text-red-600",n),children:[e.jsx("p",{className:"font-medium",children:a}),s?.message&&e.jsx("p",{className:"text-sm mt-2 text-red-500",children:s.message}),t&&e.jsx("button",{onClick:t,className:"mt-4 px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors",children:"Try Again"})]}),Aa=({message:a="No data found",description:s,icon:t,action:n,className:r})=>e.jsxs("div",{className:x("text-center py-8 text-gray-500",r),children:[t&&e.jsx("div",{className:"mb-4",children:t}),e.jsx("p",{className:"font-medium",children:a}),s&&e.jsx("p",{className:"text-sm mt-2",children:s}),n&&e.jsx("div",{className:"mt-4",children:n})]}),Ea=J("/todo")({beforeLoad:({context:a,location:s})=>{if(!S.getState().isAuthenticated)throw pe({to:"/login",search:{redirect:s.href}})},component:Da});function Da(){const[a,s]=l.useState(""),[t,n]=l.useState(""),[r,o]=l.useState(""),[i,c]=l.useState(void 0),[d,f]=l.useState("createdAt"),[p,h]=l.useState("desc"),[b,w]=l.useState(null),[T,E]=l.useState(""),j=l.useMemo(()=>({status:i,sortBy:d,sortOrder:p,limit:50}),[i,d,p]),{data:u,isLoading:k,error:M,refetch:P}=Ra(j),$=ka(),me=Ca(),ue=Sa(),he=Ta(),R=()=>a.trim()?a.trim().length<3?(o("Title must be at least 3 characters long"),!1):a.trim().length>200?(o("Title must be less than 200 characters"),!1):t.trim().length>2e3?(o("Content must be less than 2000 characters"),!1):(o(""),!0):(o("Title is required"),!1),be=y=>{y.preventDefault(),R()&&$.mutate({title:a.trim(),content:t.trim()||a.trim()},{onSuccess:()=>{s(""),n(""),o("")},onError:F=>{o(F.message||"Failed to create todo")}})},we=(y,F)=>{ue.mutate({id:y,data:{status:F}})},Ge=(y,F)=>{w(y),E(F)},We=y=>{T.trim()&&T.trim()!==""&&me.mutate({id:y,data:{title:T.trim()}},{onSuccess:()=>{w(null),E("")},onError:F=>{console.error("Failed to update todo title:",F)}})},Ze=()=>{w(null),E("")},_s=y=>{confirm("Are you sure you want to delete this todo?")&&he.mutate(y)};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(se,{title:"Todo App"}),e.jsx("div",{className:"py-8",children:e.jsxs("div",{className:"max-w-2xl mx-auto px-4",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Todo Manager"}),e.jsx("p",{className:"text-gray-600",children:"Organize your tasks and boost productivity"})]}),e.jsxs(q,{className:"mb-6",children:[e.jsx(Q,{children:e.jsx(K,{children:"Add New Task"})}),e.jsx(z,{children:e.jsxs("form",{onSubmit:be,className:"space-y-4",children:[(r||$.error)&&e.jsx("div",{className:"p-3 text-sm text-red-600 bg-red-50 border border-red-200 rounded-md",children:r||$.error?.message||"Failed to create todo"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(U,{placeholder:"Enter task title...",value:a,onChange:y=>{s(y.target.value),r&&o("")},className:"flex-1",required:!0,maxLength:200}),e.jsx(m,{type:"submit",disabled:$.isPending||!a.trim(),children:$.isPending?e.jsx(H,{className:"w-4 h-4 animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(ms,{className:"w-4 h-4 mr-2"}),"Add Task"]})})]}),e.jsx(U,{placeholder:"Enter task description (optional)...",value:t,onChange:y=>n(y.target.value),maxLength:2e3}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Title: ",a.length,"/200 characters",t&&` • Description: ${t.length}/2000 characters`]})]})})]}),e.jsxs(q,{children:[e.jsx(Q,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(K,{children:"Your Tasks"}),u&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[u.total," total • ",u.todos.filter(y=>y.status===B.COMPLETED).length," completed"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsxs("select",{value:i||"",onChange:y=>c(y.target.value||void 0),className:"px-2 py-1 border rounded",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:B.INITIAL,children:"Initial"}),e.jsx("option",{value:B.IN_PROGRESS,children:"In Progress"}),e.jsx("option",{value:B.COMPLETED,children:"Completed"}),e.jsx("option",{value:B.CANCELLED,children:"Cancelled"})]}),e.jsxs("select",{value:`${d}-${p}`,onChange:y=>{const[F,Js]=y.target.value.split("-");f(F),h(Js)},className:"px-2 py-1 border rounded",children:[e.jsx("option",{value:"createdAt-desc",children:"Newest First"}),e.jsx("option",{value:"createdAt-asc",children:"Oldest First"}),e.jsx("option",{value:"title-asc",children:"Title A-Z"}),e.jsx("option",{value:"title-desc",children:"Title Z-A"}),e.jsx("option",{value:"status-asc",children:"Status A-Z"})]})]})]})}),e.jsx(z,{children:k?e.jsx(Pa,{message:"Loading tasks..."}):M?e.jsx(Ua,{message:"Failed to load tasks",error:M,onRetry:()=>P()}):u?.todos&&u.todos.length>0?e.jsx("div",{className:"space-y-3",children:u.todos.map(y=>e.jsxs("div",{className:"flex items-center space-x-3 p-3 border rounded-lg",children:[e.jsxs("select",{value:y.status,onChange:F=>we(y.id,F.target.value),disabled:ue.isPending,className:"px-2 py-1 border rounded text-xs min-w-[100px]",children:[e.jsx("option",{value:B.INITIAL,children:"Initial"}),e.jsx("option",{value:B.IN_PROGRESS,children:"In Progress"}),e.jsx("option",{value:B.COMPLETED,children:"Completed"}),e.jsx("option",{value:B.CANCELLED,children:"Cancelled"})]}),e.jsxs("div",{className:"flex-1",children:[b===y.id?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(U,{value:T,onChange:F=>E(F.target.value),className:"text-sm",onKeyDown:F=>{F.key==="Enter"?We(y.id):F.key==="Escape"&&Ze()},autoFocus:!0}),e.jsx(m,{size:"sm",variant:"outline",onClick:()=>We(y.id),disabled:me.isPending,children:e.jsx(ne,{className:"w-3 h-3"})}),e.jsx(m,{size:"sm",variant:"outline",onClick:Ze,children:e.jsx($e,{className:"w-3 h-3"})})]}):e.jsx("div",{className:`text-sm font-medium cursor-pointer ${y.status===B.COMPLETED?"line-through text-gray-500":"text-gray-900"}`,onClick:()=>Ge(y.id,y.title),children:y.title}),y.content!==y.title&&e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:y.content}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["Created: ",new Date(y.createdAt).toLocaleDateString()]})]}),b!==y.id&&e.jsxs(e.Fragment,{children:[e.jsx(m,{variant:"outline",size:"sm",onClick:()=>Ge(y.id,y.title),children:e.jsx(at,{className:"w-4 h-4"})}),e.jsx(m,{variant:"destructive",size:"sm",onClick:()=>_s(y.id),disabled:he.isPending,children:e.jsx(Ie,{className:"w-4 h-4"})})]})]},y.id))}):e.jsx(Aa,{message:"No tasks yet",description:"Create your first task above to get started!",icon:e.jsx(nt,{className:"w-12 h-12 mx-auto text-gray-400"})})})]})]})})]})}const Ma=J("/register")({component:Fa});function Fa(){const a=Z(),s=Na(),[t,n]=l.useState({username:"",email:"",password:"",confirmPassword:""}),[r,o]=l.useState(""),i=async c=>{if(c.preventDefault(),o(""),t.password!==t.confirmPassword){o("Passwords do not match");return}s.mutate({username:t.username,email:t.email,password:t.password},{onSuccess:()=>{a({to:"/"})},onError:d=>{o(d.message||"Registration failed. Please try again.")}})};return e.jsxs("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 relative",children:[e.jsx(g,{to:"/",className:"absolute top-4 left-4",children:e.jsxs(m,{variant:"ghost",size:"sm",children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),"Back to Home"]})}),e.jsxs(q,{className:"w-full max-w-md",children:[e.jsxs(Q,{className:"text-center",children:[e.jsx(K,{className:"text-2xl",children:"Sign Up"}),e.jsx(G,{children:"Create a new account to get started"})]}),e.jsxs(z,{children:[e.jsxs("form",{onSubmit:i,className:"space-y-4",children:[(r||s.error)&&e.jsx("div",{className:"p-3 text-sm text-red-600 bg-red-50 border border-red-200 rounded-md",children:r||s.error?.message||"Registration failed. Please try again."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"username",children:"Username"}),e.jsx(U,{id:"username",type:"text",placeholder:"Enter your username",value:t.username,onChange:c=>n({...t,username:c.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"email",children:"Email"}),e.jsx(U,{id:"email",type:"email",placeholder:"Enter your email",value:t.email,onChange:c=>n({...t,email:c.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"password",children:"Password"}),e.jsx(U,{id:"password",type:"password",placeholder:"Enter your password",value:t.password,onChange:c=>n({...t,password:c.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"confirmPassword",children:"Confirm Password"}),e.jsx(U,{id:"confirmPassword",type:"password",placeholder:"Confirm your password",value:t.confirmPassword,onChange:c=>n({...t,confirmPassword:c.target.value}),required:!0})]}),e.jsx(m,{type:"submit",className:"w-full",disabled:s.isPending,children:s.isPending?"Creating Account...":"Sign Up"})]}),e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"text-sm text-gray-600",children:["Already have an account?"," ",e.jsx(g,{to:"/login",className:"text-blue-600 hover:underline",search:{redirect:"/"},children:"Sign in"})]})})]})]})]})}const Y=l.forwardRef(({className:a,...s},t)=>e.jsx(us,{ref:t,className:x("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",a),...s}));Y.displayName=us.displayName;const X=l.forwardRef(({className:a,...s},t)=>e.jsx(hs,{ref:t,className:x("aspect-square h-full w-full",a),...s}));X.displayName=hs.displayName;const ee=l.forwardRef(({className:a,...s},t)=>e.jsx(xs,{ref:t,className:x("flex h-full w-full items-center justify-center rounded-full bg-muted",a),...s}));ee.displayName=xs.displayName;const $a=J("/profile")({beforeLoad:({context:a,location:s})=>{if(!S.getState().isAuthenticated)throw pe({to:"/login",search:{redirect:s.href}})},component:Ia});function Ia(){const{user:a}=S(),{data:s,isLoading:t,error:n}=ya(),r=ba(),o=Ds(),[i,c]=l.useState({name:"",email:"",bio:"Software developer passionate about creating amazing user experiences.",avatar:""}),[d,f]=l.useState(!1),[p,h]=l.useState("");os.useEffect(()=>{s&&c({name:s.username||"",email:s.email||"",bio:"Software developer passionate about creating amazing user experiences.",avatar:s.avatarUrl||"/api/placeholder/120/120"})},[s]);const b=()=>i.name.trim()?i.name.trim().length<3?(h("Name must be at least 3 characters long"),!1):i.name.trim().length>50?(h("Name must be less than 50 characters"),!1):/^[a-zA-Z0-9_-]+$/.test(i.name.trim())?i.avatar.trim()&&!w(i.avatar.trim())?(h("Avatar URL must be a valid URL"),!1):(h(""),!0):(h("Name can only contain letters, numbers, underscores, and hyphens"),!1):(h("Name is required"),!1),w=u=>{try{return new URL(u),!0}catch{return!1}},T=()=>{if(!b())return;const u={};if(i.name!==s?.username&&(u.username=i.name.trim()),i.avatar!==s?.avatarUrl&&(u.avatarUrl=i.avatar.trim()||void 0),Object.keys(u).length===0){h("No changes to save");return}r.mutate(u,{onSuccess:()=>{f(!1),h("")},onError:k=>{h(k.message||"Failed to update profile")}})},E=()=>{const u=prompt("Enter new avatar URL:",i.avatar);u!==null&&c({...i,avatar:u})},j=()=>{o.mutate()};return t?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(se,{title:"My Profile"}),e.jsx("div",{className:"py-8",children:e.jsx("div",{className:"max-w-2xl mx-auto px-4",children:e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(H,{className:"w-6 h-6 animate-spin"}),e.jsx("span",{className:"ml-2",children:"Loading profile..."})]})})})]}):n?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(se,{title:"My Profile"}),e.jsx("div",{className:"py-8",children:e.jsx("div",{className:"max-w-2xl mx-auto px-4",children:e.jsxs("div",{className:"text-center py-8 text-red-600",children:[e.jsx("p",{children:"Failed to load profile. Please try again."}),e.jsx("p",{className:"text-sm mt-2",children:n.message})]})})})]}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(se,{title:"My Profile"}),e.jsx("div",{className:"py-8",children:e.jsxs("div",{className:"max-w-2xl mx-auto px-4",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"My Profile"}),e.jsx("p",{className:"text-gray-600",children:"Manage your account settings and preferences"})]}),e.jsxs(q,{children:[e.jsx(Q,{children:e.jsx(K,{children:"Profile Information"})}),e.jsxs(z,{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsxs(Y,{className:"w-24 h-24",children:[e.jsx(X,{src:i.avatar}),e.jsx(ee,{className:"text-lg",children:i.name.split(" ").map(u=>u[0]).join("")})]}),e.jsx(m,{size:"sm",variant:"outline",className:"absolute -bottom-2 -right-2 rounded-full w-8 h-8 p-0",onClick:E,children:e.jsx(rt,{className:"w-4 h-4"})})]}),e.jsx(m,{variant:"outline",onClick:E,children:"Change Avatar"})]}),p&&e.jsx("div",{className:"p-3 text-sm text-red-600 bg-red-50 border border-red-200 rounded-md",children:p}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"name",children:"Username"}),e.jsx(U,{id:"name",value:i.name,onChange:u=>{c({...i,name:u.target.value}),p&&h("")},placeholder:"Enter your username",maxLength:50}),e.jsx("p",{className:"text-xs text-gray-500",children:"Username can only contain letters, numbers, underscores, and hyphens"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"email",children:"Email"}),e.jsx(U,{id:"email",type:"email",value:i.email,disabled:!0,className:"bg-gray-50"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Email cannot be changed"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"avatar",children:"Avatar URL"}),e.jsx(U,{id:"avatar",value:i.avatar,onChange:u=>{c({...i,avatar:u.target.value}),p&&h("")},placeholder:"https://example.com/avatar.jpg"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Enter a valid URL for your avatar image"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"bio",children:"Bio"}),e.jsx("textarea",{id:"bio",className:"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",value:i.bio,onChange:u=>c({...i,bio:u.target.value}),placeholder:"Tell us about yourself...",disabled:!0}),e.jsx("p",{className:"text-xs text-gray-500",children:"Bio editing coming soon"})]})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsxs(m,{onClick:T,disabled:r.isPending,className:"flex items-center gap-2",children:[r.isPending?e.jsx(H,{className:"w-4 h-4 animate-spin"}):e.jsx(gs,{className:"w-4 h-4"}),r.isPending?"Saving...":"Save Changes"]})})]})]}),e.jsxs(q,{className:"mt-6",children:[e.jsx(Q,{children:e.jsx(K,{children:"Account Settings"})}),e.jsxs(z,{className:"space-y-4",children:[e.jsx(m,{variant:"outline",className:"w-full",children:"Change Password"}),e.jsx(m,{variant:"outline",className:"w-full",children:"Privacy Settings"}),e.jsxs(m,{variant:"outline",className:"w-full flex items-center gap-2",onClick:j,disabled:o.isPending,children:[o.isPending?e.jsx(H,{className:"w-4 h-4 animate-spin"}):e.jsx(Fe,{className:"w-4 h-4"}),"Sign Out"]}),e.jsx(m,{variant:"destructive",className:"w-full",children:"Delete Account"})]})]})]})})]})}const Oa=J("/login")({validateSearch:a=>({redirect:a.redirect||"/"}),component:qa});function qa(){const a=Z(),s=ls({from:"/login"}),t=va(),[n,r]=l.useState({email:"",password:""}),o=async i=>{i.preventDefault(),t.mutate(n,{onSuccess:()=>{a({to:s.redirect})},onError:c=>{console.error("Login error:",c)}})};return e.jsxs("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 relative",children:[e.jsx(g,{to:"/",className:"absolute top-4 left-4",children:e.jsxs(m,{variant:"ghost",size:"sm",children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),"Back to Home"]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(q,{className:"w-full max-w-md bg-blue-50 border-blue-200",children:e.jsx(z,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"Demo Account"}),e.jsx("p",{className:"text-sm text-blue-700 mb-3",children:"Use these credentials to test the application:"}),e.jsxs("div",{className:"bg-white p-3 rounded border text-left",children:[e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Email:"})," john@example.com"]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Password:"})," Password123"]})]})]})})}),e.jsxs(q,{className:"w-full max-w-md",children:[e.jsxs(Q,{className:"text-center",children:[e.jsx(K,{className:"text-2xl",children:"Sign In"}),e.jsx(G,{children:"Sign in to your account to continue"})]}),e.jsxs(z,{children:[e.jsxs("form",{onSubmit:o,className:"space-y-4",children:[t.error&&e.jsx("div",{className:"p-3 text-sm text-red-600 bg-red-50 border border-red-200 rounded-md",children:t.error.message||"Login failed. Please try again."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"email",children:"Email"}),e.jsx(U,{id:"email",type:"email",placeholder:"demo@example.com",value:n.email,onChange:i=>r({...n,email:i.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"password",children:"Password"}),e.jsx(U,{id:"password",type:"password",placeholder:"password",value:n.password,onChange:i=>r({...n,password:i.target.value}),required:!0})]}),e.jsx(m,{type:"submit",className:"w-full",disabled:t.isPending,children:t.isPending?"Signing In...":"Sign In"})]}),e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx(g,{to:"/forgot-password",className:"text-sm text-blue-600 hover:underline",children:"Forgot password?"}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Don't have an account?"," ",e.jsx(g,{to:"/register",className:"text-blue-600 hover:underline",children:"Sign up"})]})]})]})]})]})]})}const za=J("/forgot-password")({component:Ba});function Ba(){return e.jsxs("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 relative",children:[e.jsx(g,{to:"/login",search:{redirect:"/"},className:"absolute top-4 left-4",children:e.jsxs(m,{variant:"ghost",size:"sm",children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),"Back to Login"]})}),e.jsxs(q,{className:"w-full max-w-md",children:[e.jsxs(Q,{className:"text-center",children:[e.jsx(K,{className:"text-2xl",children:"Forgot Password"}),e.jsx(G,{children:"Enter your email to reset your password"})]}),e.jsxs(z,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"email",children:"Email"}),e.jsx(U,{id:"email",type:"email",placeholder:"Enter your email",required:!0})]}),e.jsx(m,{className:"w-full",children:"Send Reset Link"}),e.jsx("div",{className:"text-center",children:e.jsx(g,{to:"/login",search:{redirect:"/"},className:"text-sm text-blue-600 hover:underline",children:"Back to Sign In"})})]})]})]})}const Qa=fe("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function ge({className:a,variant:s,...t}){return e.jsx("div",{className:x(Qa({variant:s}),a),...t})}class Ka{baseUrl="/chat";async getRooms(s=1,t=10,n="updated_at",r="desc"){const o=new URLSearchParams({page:s.toString(),limit:t.toString(),sortBy:n,sortOrder:r});return(await v.get(`${this.baseUrl}/rooms?${o.toString()}`)).data||{rooms:[],total:0,page:1,limit:10,totalPages:0}}async getRoom(s){return(await v.get(`${this.baseUrl}/rooms/${s}`)).data?.room||{}}async createRoom(s){return(await v.post(`${this.baseUrl}/rooms`,s)).data?.room||{}}async updateRoom(s,t){return(await v.put(`${this.baseUrl}/rooms/${s}`,t)).data?.room||{}}async deleteRoom(s){await v.delete(`${this.baseUrl}/rooms/${s}`)}async joinRoom(s){return(await v.post(`${this.baseUrl}/rooms/${s}/join`)).data?.room||{}}async leaveRoom(s){await v.post(`${this.baseUrl}/rooms/${s}/leave`)}async inviteUsers(s,t){return(await v.post(`${this.baseUrl}/rooms/${s}/invite`,{userIds:t})).data||{invitedUsers:[],alreadyMembers:[],notFound:[]}}async getRoomMembers(s){return(await v.get(`${this.baseUrl}/rooms/${s}/members`)).data||{members:[],totalMembers:0,roomInfo:{id:"",name:"",authorId:"",createdAt:""}}}async removeMember(s,t){await v.delete(`${this.baseUrl}/rooms/${s}/members/${t}`)}async getMessages(s,t=1,n=50){return(await v.get(`${this.baseUrl}/rooms/${s}/messages?page=${t}&limit=${n}`)).data||{messages:[],total:0,page:1,limit:50,totalPages:0}}async updateMessage(s,t,n){return(await v.put(`${this.baseUrl}/rooms/${s}/messages/${t}`,n)).data?.message||{}}async deleteMessage(s,t){await v.delete(`${this.baseUrl}/rooms/${s}/messages/${t}`)}}const O=new Ka;class _a{socket=null;isConnected=!1;reconnectAttempts=0;maxReconnectAttempts=5;reconnectDelay=1e3;connectionPromise=null;reconnectTimeout=null;connectionRefCount=0;messageListeners=[];messageUpdateListeners=[];messageDeleteListeners=[];typingListeners=[];userJoinedListeners=[];userLeftListeners=[];userOfflineInRoomListeners=[];roomDeletedListeners=[];roomUpdatedListeners=[];roomListUpdatedListeners=[];userRemovedFromRoomListeners=[];memberRemovedListeners=[];connectionListeners=[];connect(){return this.connectionRefCount++,this.isConnected?Promise.resolve():this.connectionPromise?this.connectionPromise:(this.connectionPromise=new Promise((s,t)=>{try{this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=null);const r=S.getState().tokens?.accessToken;if(!r){this.connectionPromise=null,t(new Error("No authentication token available"));return}this.socket&&(this.socket.removeAllListeners(),this.socket.disconnect()),this.socket=ot(Le.socketUrl,{auth:{token:r},transports:["websocket","polling"],timeout:1e4,forceNew:!0}),this.socket.on("connect",()=>{console.log("Socket connected:",this.socket?.id),this.isConnected=!0,this.reconnectAttempts=0,this.connectionPromise=null,this.notifyConnectionListeners(!0),s()}),this.socket.on("disconnect",o=>{if(console.log("Socket disconnected:",o),this.isConnected=!1,this.connectionPromise=null,this.notifyConnectionListeners(!1),this.connectionRefCount>0){if(o==="io server disconnect"||o==="io client disconnect")return;this.handleReconnect()}}),this.socket.on("connect_error",o=>{console.error("Socket connection error:",o),this.isConnected=!1,this.connectionPromise=null,this.notifyConnectionListeners(!1),o.message?.includes("Authentication")||o.message?.includes("token")?this.handleTokenRefreshAndReconnect().catch(()=>{this.reconnectAttempts===0&&t(o)}):(this.reconnectAttempts===0&&t(o),this.connectionRefCount>0&&this.handleReconnect())}),this.socket.on("new-message",o=>{this.notifyMessageListeners(o.message)}),this.socket.on("message-updated",o=>{this.notifyMessageUpdateListeners(o)}),this.socket.on("message-deleted",o=>{this.notifyMessageDeleteListeners(o)}),this.socket.on("user-typing",o=>{this.notifyTypingListeners(o)}),this.socket.on("user-joined",o=>{this.notifyUserJoinedListeners(o)}),this.socket.on("user-left",o=>{this.notifyUserLeftListeners(o)}),this.socket.on("user-offline-in-room",o=>{this.notifyUserOfflineInRoomListeners(o)}),this.socket.on("room-deleted",o=>{this.notifyRoomDeletedListeners(o)}),this.socket.on("room-updated",o=>{this.notifyRoomUpdatedListeners(o)}),this.socket.on("room-list-updated",o=>{this.notifyRoomListUpdatedListeners(o)}),this.socket.on("user-removed-from-room",o=>{this.notifyUserRemovedFromRoomListeners(o)}),this.socket.on("member-removed",o=>{this.notifyMemberRemovedListeners(o)}),this.socket.on("error",o=>{console.error("Socket error:",o)})}catch(n){this.connectionPromise=null,t(n)}}),this.connectionPromise)}disconnect(){this.connectionRefCount=Math.max(0,this.connectionRefCount-1),this.connectionRefCount===0&&this.forceDisconnect()}forceDisconnect(){this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=null),this.socket&&(this.socket.removeAllListeners(),this.socket.disconnect(),this.socket=null),this.isConnected=!1,this.connectionPromise=null,this.reconnectAttempts=0,this.notifyConnectionListeners(!1)}handleReconnect(){if(this.reconnectAttempts>=this.maxReconnectAttempts){console.error("Max reconnection attempts reached");return}if(this.connectionRefCount===0)return;this.reconnectAttempts++;const s=this.reconnectDelay*Math.pow(2,this.reconnectAttempts-1);console.log(`Attempting to reconnect in ${s}ms (attempt ${this.reconnectAttempts}/${this.maxReconnectAttempts})`),this.reconnectTimeout=setTimeout(()=>{!this.isConnected&&this.connectionRefCount>0&&(this.connectionPromise=null,this.connect().catch(console.error))},s)}async handleTokenRefreshAndReconnect(){try{const s=S.getState(),t=s.tokens?.refreshToken;if(!t)throw new Error("No refresh token available");const n=await fetch(`${Le.socketUrl}/api/auth/refresh`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:t})});if(!n.ok)throw new Error(`Token refresh failed: ${n.status}`);const r=await n.json();if(!r.success||!r.data?.tokens)throw new Error("Invalid refresh token response");s.setTokens(r.data.tokens),this.connectionPromise=null,this.reconnectAttempts=0,this.connectionRefCount>0&&await this.connect()}catch(s){throw console.error("Token refresh failed:",s),S.getState().logout(),s}}joinRoom(s){if(this.socket&&this.isConnected){const t=S.getState();this.socket.emit("join-room",{roomId:s,userId:t.user?.id})}}leaveRoom(s){if(this.socket&&this.isConnected){const t=S.getState();this.socket.emit("leave-room",{roomId:s,userId:t.user?.id})}}sendMessage(s,t){this.socket&&this.isConnected&&this.socket.emit("send-message",{roomId:s,content:t})}sendTyping(s,t){if(this.socket&&this.isConnected){const n=S.getState();this.socket.emit("typing",{roomId:s,userId:n.user?.id,username:n.user?.name,isTyping:t})}}onNewMessage(s){return this.messageListeners.push(s),()=>{this.messageListeners=this.messageListeners.filter(t=>t!==s)}}onMessageUpdate(s){return this.messageUpdateListeners.push(s),()=>{this.messageUpdateListeners=this.messageUpdateListeners.filter(t=>t!==s)}}onMessageDelete(s){return this.messageDeleteListeners.push(s),()=>{this.messageDeleteListeners=this.messageDeleteListeners.filter(t=>t!==s)}}onTyping(s){return this.typingListeners.push(s),()=>{this.typingListeners=this.typingListeners.filter(t=>t!==s)}}onUserJoined(s){return this.userJoinedListeners.push(s),()=>{this.userJoinedListeners=this.userJoinedListeners.filter(t=>t!==s)}}onUserLeft(s){return this.userLeftListeners.push(s),()=>{this.userLeftListeners=this.userLeftListeners.filter(t=>t!==s)}}onUserOfflineInRoom(s){return this.userOfflineInRoomListeners.push(s),()=>{this.userOfflineInRoomListeners=this.userOfflineInRoomListeners.filter(t=>t!==s)}}onRoomDeleted(s){return this.roomDeletedListeners.push(s),()=>{this.roomDeletedListeners=this.roomDeletedListeners.filter(t=>t!==s)}}onRoomUpdated(s){return this.roomUpdatedListeners.push(s),()=>{this.roomUpdatedListeners=this.roomUpdatedListeners.filter(t=>t!==s)}}onRoomListUpdated(s){return this.roomListUpdatedListeners.push(s),()=>{this.roomListUpdatedListeners=this.roomListUpdatedListeners.filter(t=>t!==s)}}onUserRemovedFromRoom(s){return this.userRemovedFromRoomListeners.push(s),()=>{this.userRemovedFromRoomListeners=this.userRemovedFromRoomListeners.filter(t=>t!==s)}}onMemberRemoved(s){return this.memberRemovedListeners.push(s),()=>{this.memberRemovedListeners=this.memberRemovedListeners.filter(t=>t!==s)}}onConnectionChange(s){return this.connectionListeners.push(s),()=>{this.connectionListeners=this.connectionListeners.filter(t=>t!==s)}}notifyMessageListeners(s){this.messageListeners.forEach(t=>t(s))}notifyMessageUpdateListeners(s){this.messageUpdateListeners.forEach(t=>t(s))}notifyMessageDeleteListeners(s){this.messageDeleteListeners.forEach(t=>t(s))}notifyTypingListeners(s){this.typingListeners.forEach(t=>t(s))}notifyUserJoinedListeners(s){this.userJoinedListeners.forEach(t=>t(s))}notifyUserLeftListeners(s){this.userLeftListeners.forEach(t=>t(s))}notifyUserOfflineInRoomListeners(s){this.userOfflineInRoomListeners.forEach(t=>t(s))}notifyRoomDeletedListeners(s){this.roomDeletedListeners.forEach(t=>t(s))}notifyRoomUpdatedListeners(s){this.roomUpdatedListeners.forEach(t=>t(s))}notifyRoomListUpdatedListeners(s){this.roomListUpdatedListeners.forEach(t=>t(s))}notifyUserRemovedFromRoomListeners(s){this.userRemovedFromRoomListeners.forEach(t=>t(s))}notifyMemberRemovedListeners(s){this.memberRemovedListeners.forEach(t=>t(s))}notifyConnectionListeners(s){this.connectionListeners.forEach(t=>t(s))}reset(){this.connectionRefCount=0,this.forceDisconnect()}get connected(){return this.isConnected}get socketId(){return this.socket?.id}}const C=new _a,ye=cs()(it((a,s)=>({currentRoomId:null,isConnected:!1,rooms:[],messagesByRoom:{},typingUsersByRoom:{},isTyping:{},typingTimeouts:{},setCurrentRoom:t=>{a({currentRoomId:t}),t&&s().clearUnreadCount(t)},setConnected:t=>{a({isConnected:t})},setRooms:t=>{a({rooms:t})},addRoom:t=>{a(n=>({rooms:[t,...n.rooms.filter(r=>r.id!==t.id)]}))},updateRoom:(t,n)=>{a(r=>({rooms:r.rooms.map(o=>o.id===t?{...o,...n}:o)}))},removeRoom:t=>{a(n=>{const r={...n.messagesByRoom};delete r[t];const o={...n.typingUsersByRoom};return delete o[t],{rooms:n.rooms.filter(i=>i.id!==t),messagesByRoom:r,typingUsersByRoom:o,currentRoomId:n.currentRoomId===t?null:n.currentRoomId}})},setMessages:(t,n)=>{a(r=>({messagesByRoom:{...r.messagesByRoom,[t]:n}}))},addMessage:t=>{a(i=>{const c=i.messagesByRoom[t.roomId]||[];if(c.find(p=>p.id===t.id))return i;const f=c.filter(p=>!(p.isOptimistic&&p.content===t.content&&p.authorId===t.authorId&&Math.abs(new Date(p.createdAt).getTime()-new Date(t.createdAt).getTime())<1e4));return{messagesByRoom:{...i.messagesByRoom,[t.roomId]:[...f,t]}}});const{currentRoomId:n,updateLastActivity:r,incrementUnreadCount:o}=s();r(t.roomId),n!==t.roomId&&o(t.roomId)},addOptimisticMessage:t=>{const n=`temp-${Date.now()}-${Math.random()}`,r={...t,id:n,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),isOptimistic:!0};return a(o=>({messagesByRoom:{...o.messagesByRoom,[t.roomId]:[...o.messagesByRoom[t.roomId]||[],r]}})),n},updateMessage:(t,n)=>{a(r=>{const o={...r.messagesByRoom};return Object.keys(o).forEach(i=>{o[i]=o[i].map(c=>c.id===t?{...c,...n}:c)}),{messagesByRoom:o}})},removeMessage:t=>{a(n=>{const r={...n.messagesByRoom};return Object.keys(r).forEach(o=>{r[o]=r[o].filter(i=>i.id!==t)}),{messagesByRoom:r}})},markMessageError:(t,n)=>{s().updateMessage(t,{error:n,isOptimistic:!1})},setTyping:(t,n)=>{const r=s();if(r.typingTimeouts[t]&&clearTimeout(r.typingTimeouts[t]),C.sendTyping(t,n),n){const o=window.setTimeout(()=>{s().setTyping(t,!1)},3e3);a(i=>({isTyping:{...i.isTyping,[t]:!0},typingTimeouts:{...i.typingTimeouts,[t]:o}}))}else a(o=>{const i={...o.isTyping};delete i[t];const c={...o.typingTimeouts};return delete c[t],{isTyping:i,typingTimeouts:c}})},addTypingUser:t=>{a(n=>({typingUsersByRoom:{...n.typingUsersByRoom,[t.roomId]:[...(n.typingUsersByRoom[t.roomId]||[]).filter(r=>r.userId!==t.userId),t]}}))},removeTypingUser:(t,n)=>{a(r=>({typingUsersByRoom:{...r.typingUsersByRoom,[n]:(r.typingUsersByRoom[n]||[]).filter(o=>o.userId!==t)}}))},clearTypingUsers:t=>{a(n=>({typingUsersByRoom:{...n.typingUsersByRoom,[t]:[]}}))},incrementUnreadCount:t=>{a(n=>({rooms:n.rooms.map(r=>r.id===t?{...r,unreadCount:(r.unreadCount||0)+1}:r)}))},clearUnreadCount:t=>{a(n=>({rooms:n.rooms.map(r=>r.id===t?{...r,unreadCount:0}:r)}))},updateLastActivity:t=>{const n=new Date().toISOString();a(r=>({rooms:r.rooms.map(o=>o.id===t?{...o,lastActivity:n}:o)}))},sendMessage:(t,n)=>{s().addOptimisticMessage({content:n,roomId:t,authorId:"",author:{id:"",username:"",avatarUrl:""}}),C.sendMessage(t,n),s().updateLastActivity(t)},joinRoom:t=>{C.joinRoom(t)},leaveRoom:t=>{C.leaveRoom(t)},cleanup:()=>{const t=s();Object.values(t.typingTimeouts).forEach(n=>{clearTimeout(n)}),a({currentRoomId:null,isConnected:!1,rooms:[],messagesByRoom:{},typingUsersByRoom:{},isTyping:{},typingTimeouts:{}})}}),{name:"chat-store"})),N={all:["chat"],rooms:()=>[...N.all,"rooms"],room:a=>[...N.all,"room",a],roomMembers:a=>[...N.all,"room",a,"members"],messages:a=>[...N.all,"messages",a]};function Ja(a=1,s=10,t="updated_at",n="desc"){return te({queryKey:[...N.rooms(),a,s,t,n],queryFn:()=>O.getRooms(a,s,t,n),staleTime:5*60*1e3})}function Va(a){return te({queryKey:N.room(a),queryFn:()=>O.getRoom(a),enabled:!!a,staleTime:5*60*1e3})}function Ha(){const a=L();return D({mutationFn:s=>O.createRoom(s),onSuccess:()=>{a.invalidateQueries({queryKey:N.rooms()})}})}function Ga(a){const s=L();return D({mutationFn:t=>O.updateRoom(a,t),onSuccess:t=>{s.setQueryData(N.room(a),t),s.invalidateQueries({queryKey:N.rooms()})}})}function Wa(){const a=L();return D({mutationFn:s=>O.deleteRoom(s),onSuccess:(s,t)=>{a.removeQueries({queryKey:N.room(t)}),a.invalidateQueries({queryKey:N.rooms()})}})}function Za(){const a=L();return D({mutationFn:s=>O.joinRoom(s),onSuccess:(s,t)=>{a.setQueryData(N.room(t),s),a.invalidateQueries({queryKey:N.rooms()}),C.joinRoom(t)}})}function Ya(){const a=L();return D({mutationFn:s=>O.leaveRoom(s),onSuccess:(s,t)=>{C.leaveRoom(t),a.invalidateQueries({queryKey:N.rooms()})}})}function Xa(){const a=L();return D({mutationFn:({roomId:s,userIds:t})=>O.inviteUsers(s,t),onSuccess:(s,t)=>{a.invalidateQueries({queryKey:N.rooms()}),a.invalidateQueries({queryKey:N.room(t.roomId)}),console.log(`Successfully invited ${s.invitedUsers.length} users`),s.alreadyMembers.length>0&&console.log(`${s.alreadyMembers.length} users were already members`),s.notFound.length>0&&console.log(`${s.notFound.length} users were not found`)}})}function en(a){return te({queryKey:N.roomMembers(a),queryFn:()=>O.getRoomMembers(a),enabled:!!a,staleTime:2*60*1e3})}function sn(){const a=L();return D({mutationFn:({roomId:s,memberId:t})=>O.removeMember(s,t),onSuccess:(s,t)=>{a.invalidateQueries({queryKey:N.roomMembers(t.roomId)}),a.invalidateQueries({queryKey:N.room(t.roomId)})}})}function tn(a,s=50){return lt({queryKey:[...N.messages(a),"infinite"],queryFn:({pageParam:t=1})=>O.getMessages(a,t,s),enabled:!!a,initialPageParam:1,getNextPageParam:t=>{if(t.page<t.totalPages)return t.page+1},staleTime:1*60*1e3})}function an(a){const s=L();return D({mutationFn:({messageId:t,data:n})=>O.updateMessage(a,t,n),onSuccess:()=>{s.invalidateQueries({queryKey:N.messages(a)})}})}function nn(a){const s=L();return D({mutationFn:t=>O.deleteMessage(a,t),onSuccess:()=>{s.invalidateQueries({queryKey:N.messages(a)})}})}function rn(a){const s=L(),t=l.useCallback(o=>{o.roomId===a&&(s.setQueryData([...N.messages(a),"infinite"],i=>{if(!i)return i;const c=[...i.pages];return c.length>0&&(c[0]={...c[0],messages:[...c[0].messages,o],total:c[0].total+1}),{...i,pages:c}}),s.invalidateQueries({queryKey:N.messages(a)}))},[s,a]),n=l.useCallback(o=>{o.roomId===a&&s.setQueryData([...N.messages(a),"infinite"],i=>{if(!i)return i;const c=i.pages.map(d=>({...d,messages:d.messages.map(f=>f.id===o.messageId?{...f,content:o.content,updatedAt:new Date().toISOString()}:f)}));return{...i,pages:c}})},[s,a]),r=l.useCallback(o=>{o.roomId===a&&s.setQueryData([...N.messages(a),"infinite"],i=>{if(!i)return i;const c=i.pages.map(d=>({...d,messages:d.messages.filter(f=>f.id!==o.messageId),total:Math.max(0,d.total-1)}));return{...i,pages:c}})},[s,a]);l.useEffect(()=>{if(!a)return;const o=C.onNewMessage(t),i=C.onMessageUpdate(n),c=C.onMessageDelete(r);return()=>{o(),i(),c()}},[a,t,n,r])}function on(a){const{addTypingUser:s,removeTypingUser:t}=ye(),n=l.useCallback(r=>{r.roomId===a&&(r.isTyping?s({userId:r.userId,username:r.username,roomId:r.roomId}):t(r.userId,r.roomId))},[a,s,t]);l.useEffect(()=>C.onTyping(n),[n])}function ln(){const a=L(),s=l.useCallback(t=>{a.invalidateQueries({queryKey:N.roomMembers(t.roomId)}),console.log(`${t.username} went offline in room ${t.roomId}`)},[a]);l.useEffect(()=>C.onUserOfflineInRoom(s),[s])}function cn(){const a=L(),s=l.useCallback(t=>{a.invalidateQueries({queryKey:N.rooms()}),console.log(`Room deleted: ${t.message}`)},[a]);l.useEffect(()=>C.onRoomDeleted(s),[s])}function dn(a){const s=Z(),t=l.useCallback(n=>{n.roomId===a&&(alert(n.message),s({to:"/chat"}))},[a,s]);l.useEffect(()=>C.onRoomDeleted(t),[t])}function mn(){const a=L(),s=l.useCallback(n=>{a.invalidateQueries({queryKey:N.room(n.roomId)}),console.log(`Room updated: ${n.message}`)},[a]),t=l.useCallback(n=>{a.invalidateQueries({queryKey:N.rooms()}),console.log(`Room list updated: ${n.action} room ${n.room?.name||""}`)},[a]);l.useEffect(()=>{const n=C.onRoomUpdated(s),r=C.onRoomListUpdated(t);return()=>{n(),r()}},[s,t])}function un(a){const s=l.useCallback(t=>{t.roomId===a&&console.log(`Current room updated: ${t.message}`)},[a]);l.useEffect(()=>C.onRoomUpdated(s),[s])}function hn(){const a=Z(),s=l.useCallback(t=>{alert(t.message),a({to:"/chat"})},[a]);l.useEffect(()=>C.onUserRemovedFromRoom(s),[s])}function xn(){const a=L(),s=l.useCallback(t=>{a.invalidateQueries({queryKey:N.roomMembers(t.roomId)}),a.invalidateQueries({queryKey:N.room(t.roomId)}),console.log(`Member removed: ${t.message}`)},[a]);l.useEffect(()=>C.onMemberRemoved(s),[s])}function gn(){const[a,s]=l.useState(C.connected);return l.useEffect(()=>C.onConnectionChange(s),[]),{connected:a}}const ve=mt,Ms=ut,fn=ct,Fs=l.forwardRef(({className:a,...s},t)=>e.jsx(fs,{ref:t,className:x("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...s}));Fs.displayName=fs.displayName;const ie=l.forwardRef(({className:a,children:s,...t},n)=>e.jsxs(fn,{children:[e.jsx(Fs,{}),e.jsxs(ps,{ref:n,className:x("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...t,children:[s,e.jsxs(dt,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx($e,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));ie.displayName=ps.displayName;const le=({className:a,...s})=>e.jsx("div",{className:x("flex flex-col space-y-1.5 text-center sm:text-left",a),...s});le.displayName="DialogHeader";const qe=({className:a,...s})=>e.jsx("div",{className:x("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",a),...s});qe.displayName="DialogFooter";const ce=l.forwardRef(({className:a,...s},t)=>e.jsx(js,{ref:t,className:x("text-lg font-semibold leading-none tracking-tight",a),...s}));ce.displayName=js.displayName;const de=l.forwardRef(({className:a,...s},t)=>e.jsx(ys,{ref:t,className:x("text-sm text-muted-foreground",a),...s}));de.displayName=ys.displayName;const pn=xt,$s=l.createContext({}),ss=({...a})=>e.jsx($s.Provider,{value:{name:a.name},children:e.jsx(gt,{...a})}),Ne=()=>{const a=l.useContext($s),s=l.useContext(Is),{getFieldState:t,formState:n}=ht(),r=t(a.name,n);if(!a)throw new Error("useFormField should be used within <FormField>");const{id:o}=s;return{id:o,name:a.name,formItemId:`${o}-form-item`,formDescriptionId:`${o}-form-item-description`,formMessageId:`${o}-form-item-message`,...r}},Is=l.createContext({}),Pe=l.forwardRef(({className:a,...s},t)=>{const n=l.useId();return e.jsx(Is.Provider,{value:{id:n},children:e.jsx("div",{ref:t,className:x("space-y-2",a),...s})})});Pe.displayName="FormItem";const Ue=l.forwardRef(({className:a,...s},t)=>{const{error:n,formItemId:r}=Ne();return e.jsx(A,{ref:t,className:x(n&&"text-destructive",a),htmlFor:r,...s})});Ue.displayName="FormLabel";const Ae=l.forwardRef(({...a},s)=>{const{error:t,formItemId:n,formDescriptionId:r,formMessageId:o}=Ne();return e.jsx("div",{ref:s,id:n,"aria-describedby":t?`${r} ${o}`:`${r}`,"aria-invalid":!!t,...a})});Ae.displayName="FormControl";const Ee=l.forwardRef(({className:a,...s},t)=>{const{formDescriptionId:n}=Ne();return e.jsx("p",{ref:t,id:n,className:x("text-sm text-muted-foreground",a),...s})});Ee.displayName="FormDescription";const De=l.forwardRef(({className:a,children:s,...t},n)=>{const{error:r,formMessageId:o}=Ne(),i=r?String(r?.message):s;return i?e.jsx("p",{ref:n,id:o,className:x("text-sm font-medium text-destructive",a),...t,children:i}):null});De.displayName="FormMessage";const jn=ft({name:Ye().min(1,"Room name is required").max(100,"Room name must be less than 100 characters").regex(/^[a-zA-Z0-9\s\-_]+$/,"Room name can only contain letters, numbers, spaces, hyphens, and underscores"),avatarUrl:Ye().url("Must be a valid URL").optional().or(pt(""))});function yn({open:a,onOpenChange:s}){const t=Ha(),n=jt({resolver:yt(jn),defaultValues:{name:"",avatarUrl:""}}),r=async i=>{try{await t.mutateAsync({name:i.name,avatarUrl:i.avatarUrl||void 0}),s(!1),n.reset()}catch(c){console.error("Failed to create room:",c)}},o=()=>{t.isPending||(s(!1),n.reset())};return e.jsx(ve,{open:a,onOpenChange:o,children:e.jsxs(ie,{className:"sm:max-w-[425px]",children:[e.jsxs(le,{children:[e.jsx(ce,{children:"Create New Room"}),e.jsx(de,{children:"Create a new chat room to start conversations with your team."})]}),e.jsx(pn,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(r),className:"space-y-4",children:[e.jsx(ss,{control:n.control,name:"name",render:({field:i})=>e.jsxs(Pe,{children:[e.jsx(Ue,{children:"Room Name"}),e.jsx(Ae,{children:e.jsx(U,{placeholder:"Enter room name...",...i,disabled:t.isPending})}),e.jsx(Ee,{children:"Choose a descriptive name for your room."}),e.jsx(De,{})]})}),e.jsx(ss,{control:n.control,name:"avatarUrl",render:({field:i})=>e.jsxs(Pe,{children:[e.jsx(Ue,{children:"Avatar URL (Optional)"}),e.jsx(Ae,{children:e.jsx(U,{placeholder:"https://example.com/avatar.jpg",...i,disabled:t.isPending})}),e.jsx(Ee,{children:"Provide a URL for the room's avatar image."}),e.jsx(De,{})]})}),e.jsxs(qe,{children:[e.jsx(m,{type:"button",variant:"outline",onClick:o,disabled:t.isPending,children:"Cancel"}),e.jsx(m,{type:"submit",disabled:t.isPending,children:t.isPending?"Creating...":"Create Room"})]})]})})]})})}function vn({room:a,isSelected:s,onClick:t}){const n=Za(),{user:r}=S(),o=i=>{i.stopPropagation(),n.mutate(a.id)};return e.jsxs("div",{onClick:t,className:`flex items-center gap-3 p-3 cursor-pointer transition-colors hover:bg-gray-100 ${s?"bg-blue-50 border-r-2 border-blue-500":""}`,children:[e.jsxs("div",{className:"relative",children:[e.jsxs(Y,{className:"w-10 h-10",children:[e.jsx(X,{src:a.avatarUrl}),e.jsx(ee,{children:e.jsx(Nt,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-green-500 border-2 border-white rounded-full"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-medium text-gray-900 truncate",children:a.name}),e.jsxs("div",{className:"flex items-center gap-1",children:[a.unreadCount&&a.unreadCount>0&&e.jsx(ge,{variant:"destructive",className:"text-xs",children:a.unreadCount>99?"99+":a.unreadCount}),a.lastActivity&&e.jsx("span",{className:"text-xs text-gray-500",children:Ns(new Date(a.lastActivity),{addSuffix:!0})})]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500",children:[e.jsx(je,{className:"w-3 h-3"}),e.jsxs("span",{children:[a.participants.length," members"]})]}),r&&!a.participants.includes(r.id)&&e.jsx(m,{size:"sm",variant:"outline",onClick:o,disabled:n.isPending,className:"h-6 px-2 text-xs",children:n.isPending?"Joining...":"Join"})]})]})]})}function Nn({onRoomSelect:a,selectedRoomId:s}){const[t,n]=l.useState(""),[r,o]=l.useState(!1),{data:i,isLoading:c,error:d,refetch:f}=Ja(1,10,"updated_at","desc");cn(),mn();const p=i?.rooms||[];console.log("ChatRoomList Debug:",{isLoading:c,error:d,roomsData:i,rooms:p,roomsCount:p.length});const h=p.filter(b=>b.name.toLowerCase().includes(t.toLowerCase()));return c?e.jsx("div",{className:"h-full flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-600",children:"Loading rooms..."})]})}):d?e.jsx("div",{className:"h-full flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-red-600 mb-2",children:"Failed to load rooms"}),e.jsx(m,{variant:"outline",onClick:()=>window.location.reload(),children:"Retry"})]})}):e.jsxs("div",{className:"h-full flex flex-col bg-white border-r",children:[e.jsxs("div",{className:"p-4 border-b",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900",children:["Chat Rooms (",p.length,")"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(m,{size:"sm",variant:"outline",onClick:()=>f(),className:"h-8 w-8 p-0",title:"Refresh rooms",children:e.jsx(vt,{className:"h-4 w-4"})}),e.jsx(m,{size:"sm",onClick:()=>o(!0),className:"h-8 w-8 p-0",children:e.jsx(ms,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(vs,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search rooms...",value:t,onChange:b=>n(b.target.value),className:"w-full pl-9 pr-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:h.length===0?e.jsxs("div",{className:"p-4 text-center text-gray-500",children:[t?"No rooms found":"No rooms available",!t&&e.jsx("div",{className:"mt-2",children:e.jsx(m,{variant:"outline",size:"sm",onClick:()=>o(!0),children:"Create your first room"})})]}):e.jsx("div",{className:"divide-y",children:h.map(b=>e.jsx(vn,{room:b,isSelected:s===b.id,onClick:()=>a(b.id)},b.id))})}),e.jsx(yn,{open:r,onOpenChange:o})]})}const bn=kt,wn=Ct,Rn=l.forwardRef(({className:a,inset:s,children:t,...n},r)=>e.jsxs(bs,{ref:r,className:x("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",s&&"pl-8",a),...n,children:[t,e.jsx(bt,{className:"ml-auto h-4 w-4"})]}));Rn.displayName=bs.displayName;const kn=l.forwardRef(({className:a,...s},t)=>e.jsx(ws,{ref:t,className:x("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...s}));kn.displayName=ws.displayName;const Os=l.forwardRef(({className:a,sideOffset:s=4,...t},n)=>e.jsx(wt,{children:e.jsx(Rs,{ref:n,sideOffset:s,className:x("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...t})}));Os.displayName=Rs.displayName;const ae=l.forwardRef(({className:a,inset:s,...t},n)=>e.jsx(ks,{ref:n,className:x("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s&&"pl-8",a),...t}));ae.displayName=ks.displayName;const Cn=l.forwardRef(({className:a,children:s,checked:t,...n},r)=>e.jsxs(Cs,{ref:r,className:x("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),checked:t,...n,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Ss,{children:e.jsx(ne,{className:"h-4 w-4"})})}),s]}));Cn.displayName=Cs.displayName;const Sn=l.forwardRef(({className:a,children:s,...t},n)=>e.jsxs(Ts,{ref:n,className:x("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...t,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Ss,{children:e.jsx(Rt,{className:"h-2 w-2 fill-current"})})}),s]}));Sn.displayName=Ts.displayName;const Tn=l.forwardRef(({className:a,inset:s,...t},n)=>e.jsx(Ls,{ref:n,className:x("px-2 py-1.5 text-sm font-semibold",s&&"pl-8",a),...t}));Tn.displayName=Ls.displayName;const Me=l.forwardRef(({className:a,...s},t)=>e.jsx(Ps,{ref:t,className:x("-mx-1 my-1 h-px bg-muted",a),...s}));Me.displayName=Ps.displayName;function ze({...a}){return e.jsx(St,{"data-slot":"alert-dialog",...a})}function Ln({...a}){return e.jsx(Et,{"data-slot":"alert-dialog-trigger",...a})}function Pn({...a}){return e.jsx(Dt,{"data-slot":"alert-dialog-portal",...a})}function Un({className:a,...s}){return e.jsx(Mt,{"data-slot":"alert-dialog-overlay",className:x("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",a),...s})}function Be({className:a,...s}){return e.jsxs(Pn,{children:[e.jsx(Un,{}),e.jsx(Tt,{"data-slot":"alert-dialog-content",className:x("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",a),...s})]})}function Qe({className:a,...s}){return e.jsx("div",{"data-slot":"alert-dialog-header",className:x("flex flex-col gap-2 text-center sm:text-left",a),...s})}function Ke({className:a,...s}){return e.jsx("div",{"data-slot":"alert-dialog-footer",className:x("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",a),...s})}function _e({className:a,...s}){return e.jsx(Lt,{"data-slot":"alert-dialog-title",className:x("text-lg font-semibold",a),...s})}function Je({className:a,...s}){return e.jsx(Pt,{"data-slot":"alert-dialog-description",className:x("text-muted-foreground text-sm",a),...s})}function Ve({className:a,...s}){return e.jsx(At,{className:x(Oe(),a),...s})}function He({className:a,...s}){return e.jsx(Ut,{className:x(Oe({variant:"outline"}),a),...s})}function An({message:a,isOwner:s,onEdit:t,onDelete:n,onReply:r}){const[o,i]=l.useState(!1),c=async()=>{try{await navigator.clipboard.writeText(a.content)}catch(f){console.error("Failed to copy message:",f)}},d=()=>{n?.(a.id),i(!1)};return e.jsxs(e.Fragment,{children:[e.jsxs(bn,{children:[e.jsx(wn,{asChild:!0,children:e.jsx(m,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(Ft,{className:"w-3 h-3"})})}),e.jsxs(Os,{align:"end",className:"w-48",children:[r&&e.jsxs(e.Fragment,{children:[e.jsxs(ae,{onClick:()=>r(a),children:[e.jsx($t,{className:"w-4 h-4 mr-2"}),"Reply"]}),e.jsx(Me,{})]}),e.jsxs(ae,{onClick:c,children:[e.jsx(ke,{className:"w-4 h-4 mr-2"}),"Copy message"]}),s&&e.jsxs(e.Fragment,{children:[e.jsx(Me,{}),t&&e.jsxs(ae,{onClick:()=>t(a.id),children:[e.jsx(Ce,{className:"w-4 h-4 mr-2"}),"Edit message"]}),n&&e.jsxs(ae,{onClick:()=>i(!0),className:"text-red-600 focus:text-red-600",children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"}),"Delete message"]})]})]})]}),e.jsx(ze,{open:o,onOpenChange:i,children:e.jsxs(Be,{children:[e.jsxs(Qe,{children:[e.jsx(_e,{children:"Delete Message"}),e.jsx(Je,{children:"Are you sure you want to delete this message? This action cannot be undone."})]}),e.jsxs(Ke,{children:[e.jsx(He,{children:"Cancel"}),e.jsx(Ve,{onClick:d,className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})})]})}function En({message:a,isOwn:s,showAvatar:t,onEdit:n,onDelete:r}){const[o,i]=l.useState(!1),[c,d]=l.useState(a.content),f=()=>{c.trim()&&c!==a.content&&n(a.id,c.trim()),i(!1)},p=w=>{w.key==="Enter"&&!w.shiftKey?(w.preventDefault(),f()):w.key==="Escape"&&(i(!1),d(a.content))},h=w=>{i(!0)},b=w=>{r(w)};return e.jsxs("div",{className:`flex gap-3 p-3 hover:bg-gray-50 group ${s?"flex-row-reverse":""}`,children:[t&&e.jsxs(Y,{className:"w-8 h-8 flex-shrink-0",children:[e.jsx(X,{src:a.author.avatarUrl}),e.jsx(ee,{children:a.author.username.charAt(0).toUpperCase()})]}),e.jsxs("div",{className:`flex-1 min-w-0 ${s?"text-right":""}`,children:[t&&e.jsxs("div",{className:`flex items-center gap-2 mb-1 ${s?"justify-end":""}`,children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:a.author.username}),e.jsx("span",{className:"text-xs text-gray-500",children:Ns(new Date(a.createdAt),{addSuffix:!0})})]}),e.jsxs("div",{className:`relative ${s?"ml-8":"mr-8"}`,children:[o?e.jsxs("div",{className:"space-y-2",children:[e.jsx("textarea",{value:c,onChange:w=>d(w.target.value),onKeyDown:p,className:"w-full p-2 text-sm border rounded resize-none focus:outline-none focus:ring-2 focus:ring-blue-500",rows:Math.min(c.split(`
`).length,5),autoFocus:!0}),e.jsxs("div",{className:"flex gap-2 text-xs",children:[e.jsx(m,{size:"sm",onClick:f,children:"Save"}),e.jsx(m,{size:"sm",variant:"outline",onClick:()=>i(!1),children:"Cancel"})]})]}):e.jsxs("div",{className:`inline-block max-w-full p-3 rounded-lg text-sm break-words ${s?"bg-blue-500 text-white":"bg-gray-100 text-gray-900"} ${a.isOptimistic?"opacity-70":""} ${a.error?"bg-red-100 border border-red-300":""}`,children:[a.content,a.error&&e.jsxs("div",{className:"mt-1 text-xs text-red-600",children:["Failed to send: ",a.error]})]}),!o&&!a.isOptimistic&&e.jsx("div",{className:`absolute top-0 ${s?"left-0 -translate-x-full":"right-0 translate-x-full"}`,children:e.jsx(An,{message:a,isOwner:s,onEdit:h,onDelete:b})})]})]})]})}function Dn({roomId:a,messages:s,isLoading:t,hasNextPage:n,onLoadMore:r}){const o=l.useRef(null),i=l.useRef(null),[c,d]=l.useState(!0),{user:f}=S(),{typingUsersByRoom:p}=ye(),h=an(a),b=nn(a),w=p[a]||[];l.useEffect(()=>{c&&o.current&&o.current.scrollIntoView({behavior:"smooth"})},[s,c]);const T=()=>{if(!i.current)return;const{scrollTop:u,scrollHeight:k,clientHeight:M}=i.current,P=k-u-M<100;d(P),u===0&&n&&r&&r()},E=(u,k)=>{h.mutate({messageId:u,data:{content:k}})},j=u=>{b.mutate(u)};return t&&s.length===0?e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsx("div",{className:"text-gray-500",children:"Loading messages..."})}):e.jsx("div",{className:"flex-1 flex flex-col",children:e.jsxs("div",{ref:i,onScroll:T,className:"flex-1 overflow-y-auto",children:[n&&e.jsx("div",{className:"p-4 text-center",children:e.jsx(m,{variant:"outline",size:"sm",onClick:r,disabled:t,children:t?"Loading...":"Load more messages"})}),e.jsx("div",{className:"space-y-1",children:s.map((u,k)=>{const M=s[k-1],P=u.author.id===f?.id,$=!M||M.author.id!==u.author.id||new Date(u.createdAt).getTime()-new Date(M.createdAt).getTime()>5*60*1e3;return e.jsx(En,{message:u,isOwn:P,showAvatar:$,onEdit:E,onDelete:j},u.id)})}),w.length>0&&e.jsx("div",{className:"p-3 text-sm text-gray-500",children:w.length===1?e.jsxs("span",{children:[w[0].username," is typing..."]}):e.jsxs("span",{children:[w.map(u=>u.username).join(", ")," are typing..."]})}),e.jsx("div",{ref:o})]})})}function Mn({onEmojiSelect:a,disabled:s=!1}){const[t,n]=l.useState(!1),r=l.useRef(null),o=l.useRef(null);l.useEffect(()=>{const c=d=>{r.current&&o.current&&!r.current.contains(d.target)&&!o.current.contains(d.target)&&n(!1)};if(t)return document.addEventListener("mousedown",c),()=>document.removeEventListener("mousedown",c)},[t]);const i=c=>{a(c.native),n(!1)};return e.jsxs("div",{className:"relative",children:[e.jsx(m,{ref:o,type:"button",variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>n(!t),disabled:s,title:"Add emoji",children:e.jsx(It,{className:"w-4 h-4"})}),t&&e.jsx("div",{ref:r,className:"absolute bottom-full right-0 mb-2 z-50",children:e.jsx("div",{className:"bg-white rounded-lg shadow-lg border",children:e.jsx(Ot,{data:qt,onEmojiSelect:i,theme:"light",set:"native",previewPosition:"none",skinTonePosition:"none",maxFrequentRows:2,perLine:8,emojiSize:20,emojiButtonSize:28,searchPosition:"sticky",navPosition:"bottom"})})})]})}function Fn({roomId:a,disabled:s=!1,placeholder:t="Type a message..."}){const[n,r]=l.useState(""),[o,i]=l.useState(!1),c=l.useRef(null),d=l.useRef(null),f=l.useRef(0),{sendMessage:p,setTyping:h}=ye(),b=j=>{const u=c.current;if(!u)return;const k=u.selectionStart,M=u.selectionEnd,P=n.slice(0,k)+j+n.slice(M);r(P),E({target:{value:P}}),setTimeout(()=>{u.focus();const $=k+j.length;u.setSelectionRange($,$)},0)},w=j=>{j.preventDefault(),!(!n.trim()||s)&&(p(a,n.trim()),r(""),o&&(h(a,!1),i(!1)),c.current&&(c.current.style.height="auto"))},T=j=>{j.key==="Enter"&&!j.shiftKey&&(j.preventDefault(),w(j))},E=j=>{const u=j.target.value;r(u),c.current&&(c.current.style.height="auto",c.current.style.height=`${Math.min(c.current.scrollHeight,120)}px`);const k=Date.now();u.trim()?(o?k-f.current>1e3&&(h(a,!0),f.current=k):(i(!0),h(a,!0),f.current=k),d.current&&clearTimeout(d.current),d.current=window.setTimeout(()=>{i(!1),h(a,!1)},3e3)):o&&(i(!1),h(a,!1),d.current&&(clearTimeout(d.current),d.current=null))};return l.useEffect(()=>()=>{d.current&&clearTimeout(d.current),o&&h(a,!1)},[a,o,h]),e.jsxs("div",{className:"sticky bottom-0 z-10 border-t bg-white p-4 shadow-lg",children:[e.jsxs("form",{onSubmit:w,className:"flex items-end gap-2",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("textarea",{ref:c,value:n,onChange:E,onKeyDown:T,placeholder:t,disabled:s,className:"w-full resize-none rounded-lg border border-gray-300 px-3 py-2 pr-10 text-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 disabled:bg-gray-100 disabled:cursor-not-allowed",style:{minHeight:"40px",maxHeight:"120px"},rows:1}),e.jsx("div",{className:"absolute right-2 top-1/2 -translate-y-1/2",children:e.jsx(Mn,{onEmojiSelect:b,disabled:s})})]}),e.jsxs(m,{type:"submit",size:"sm",disabled:!n.trim()||s,className:"h-10 px-3",children:[e.jsx(zt,{className:"w-4 h-4"}),e.jsx("span",{className:"sr-only",children:"Send message"})]})]}),n.length>1800&&e.jsxs("div",{className:"mt-1 text-xs text-gray-500 text-right",children:[n.length,"/2000"]})]})}const qs=l.forwardRef(({className:a,...s},t)=>e.jsx(Us,{ref:t,className:x("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",a),...s,children:e.jsx(Bt,{className:x("flex items-center justify-center text-current"),children:e.jsx(ne,{className:"h-4 w-4"})})}));qs.displayName=Us.displayName;class $n{baseUrl="/users";async searchUsers(s,t=1,n=10,r){const o=new URLSearchParams({page:t.toString(),limit:n.toString()});return s&&s.trim()&&o.append("q",s.trim()),r&&o.append("roomId",r),(await v.get(`${this.baseUrl}/search?${o.toString()}`)).data||{users:[],total:0,page:1,limit:10,totalPages:0}}}const In=new $n,zs={all:["users"],search:(a,s,t,n)=>[...zs.all,"search",{query:a,page:s,limit:t,roomId:n}]};function On(a,s=1,t=10,n){return te({queryKey:zs.search(a,s,t,n),queryFn:()=>In.searchUsers(a,s,t,n),staleTime:5*60*1e3,enabled:!0})}function qn(a,s){const[t,n]=l.useState(a);return l.useEffect(()=>{const r=setTimeout(()=>{n(a)},s);return()=>{clearTimeout(r)}},[a,s]),t}function zn({open:a,onOpenChange:s,roomId:t,roomName:n}){const[r,o]=l.useState(""),[i,c]=l.useState([]),d=qn(r,300),{data:f,isLoading:p}=On(d,1,20,t),h=Xa(),b=f?.users||[],w=(j,u)=>{c(u?k=>[...k,j]:k=>k.filter(M=>M!==j))},T=async()=>{if(i.length!==0)try{await h.mutateAsync({roomId:t,userIds:i}),c([]),o(""),s(!1)}catch(j){console.error("Failed to invite users:",j)}},E=()=>{c([]),o(""),s(!1)};return e.jsx(ve,{open:a,onOpenChange:E,children:e.jsxs(ie,{className:"sm:max-w-md",children:[e.jsxs(le,{children:[e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"h-5 w-5"}),"Invite Users to ",n]}),e.jsx(de,{children:"Search and select users to invite to this chat room."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"search",children:"Search Users"}),e.jsxs("div",{className:"relative",children:[e.jsx(vs,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(U,{id:"search",placeholder:"Search by username or email...",value:r,onChange:j=>o(j.target.value),className:"pl-10"})]})]}),i.length>0&&e.jsxs("div",{className:"text-sm text-gray-600",children:[i.length," user(s) selected"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Available Users"}),e.jsx("div",{className:"h-64 border rounded-md p-2 overflow-y-auto",children:p?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(H,{className:"h-6 w-6 animate-spin"}),e.jsx("span",{className:"ml-2",children:"Searching users..."})]}):b.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:r?"No users found":"No users available"}):e.jsx("div",{className:"space-y-2",children:b.map(j=>e.jsxs("div",{className:"flex items-center space-x-3 p-2 rounded-lg hover:bg-gray-50",children:[e.jsx(qs,{id:j.id,checked:i.includes(j.id),onCheckedChange:u=>w(j.id,u)}),e.jsxs(Y,{className:"h-8 w-8",children:[e.jsx(X,{src:j.avatarUrl,alt:j.username}),e.jsx(ee,{children:j.username.charAt(0).toUpperCase()})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:j.username}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:j.email})]})]},j.id))})})]})]}),e.jsxs(qe,{children:[e.jsx(m,{variant:"outline",onClick:E,children:"Cancel"}),e.jsx(m,{onClick:T,disabled:i.length===0||h.isPending,children:h.isPending?e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"h-4 w-4 animate-spin mr-2"}),"Inviting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Se,{className:"h-4 w-4 mr-2"}),"Invite ",i.length," User(s)"]})})]})]})})}function ts({className:a,orientation:s="horizontal",decorative:t=!0,...n}){return e.jsx(Qt,{"data-slot":"separator",decorative:t,orientation:s,className:x("bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px",a),...n})}function Bn({room:a,trigger:s}){const[t,n]=l.useState(!1),[r,o]=l.useState({name:a.name,avatarUrl:a.avatarUrl||""}),i=Ga(a.id),c=async h=>{h.preventDefault();try{await i.mutateAsync({name:r.name.trim(),avatarUrl:r.avatarUrl.trim()||void 0}),n(!1)}catch(b){console.error("Failed to update room:",b)}},d=(h,b)=>{o(w=>({...w,[h]:b}))},f=r.name.trim().length>0,p=r.name!==a.name||r.avatarUrl!==(a.avatarUrl||"");return e.jsxs(ve,{open:t,onOpenChange:n,children:[e.jsx(Ms,{asChild:!0,children:s||e.jsxs(m,{variant:"outline",className:"justify-start",children:[e.jsx(Ce,{className:"w-4 h-4 mr-2"}),"Edit Room Info"]})}),e.jsxs(ie,{className:"sm:max-w-md",children:[e.jsxs(le,{children:[e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"w-5 h-5"}),"Edit Room Information"]}),e.jsx(de,{children:"Update the room name and avatar URL."})]}),e.jsxs("form",{onSubmit:c,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"room-name",children:"Room Name"}),e.jsx(U,{id:"room-name",value:r.name,onChange:h=>d("name",h.target.value),placeholder:"Enter room name",maxLength:100,required:!0}),e.jsxs("p",{className:"text-xs text-gray-500",children:[r.name.length,"/100 characters"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"avatar-url",children:"Avatar URL (optional)"}),e.jsx(U,{id:"avatar-url",type:"url",value:r.avatarUrl,onChange:h=>d("avatarUrl",h.target.value),placeholder:"https://example.com/avatar.jpg"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Provide a URL for the room's avatar image"})]}),r.avatarUrl&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Preview"}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx("img",{src:r.avatarUrl,alt:"Room avatar preview",className:"w-10 h-10 rounded-full object-cover",onError:h=>{h.target.style.display="none"}}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:r.name}),e.jsx("p",{className:"text-sm text-gray-500",children:"Room preview"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsxs(m,{type:"button",variant:"outline",onClick:()=>n(!1),disabled:i.isPending,children:[e.jsx($e,{className:"w-4 h-4 mr-2"}),"Cancel"]}),e.jsxs(m,{type:"submit",disabled:!f||!p||i.isPending,children:[e.jsx(gs,{className:"w-4 h-4 mr-2"}),i.isPending?"Saving...":"Save Changes"]})]})]})]})]})}function Qn({roomId:a,roomName:s,trigger:t}){const[n,r]=l.useState(!1),[o,i]=l.useState(""),c=Z(),d=Wa(),f=async()=>{try{await d.mutateAsync(a),r(!1),c({to:"/chat"})}catch(h){console.error("Failed to delete room:",h)}},p=o===s;return e.jsxs(ze,{open:n,onOpenChange:r,children:[e.jsx(Ln,{asChild:!0,children:t||e.jsxs(m,{variant:"outline",className:"justify-start text-red-600 hover:text-red-700",children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"}),"Delete Room"]})}),e.jsxs(Be,{className:"sm:max-w-md",children:[e.jsxs(Qe,{children:[e.jsxs(_e,{className:"flex items-center gap-2 text-red-600",children:[e.jsx(Te,{className:"w-5 h-5"}),"Delete Room"]}),e.jsxs(Je,{className:"space-y-3",children:[e.jsxs("p",{children:["This action cannot be undone. This will permanently delete the room",e.jsxs("strong",{className:"font-semibold",children:[' "',s,'"']})," and remove all messages."]}),e.jsx("p",{children:"All members will lose access to this room and its message history."})]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Te,{className:"w-5 h-5 text-red-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium text-red-800",children:"Warning: This action is irreversible"}),e.jsxs("ul",{className:"text-sm text-red-700 space-y-1",children:[e.jsx("li",{children:"• All messages will be permanently deleted"}),e.jsx("li",{children:"• All members will be removed from the room"}),e.jsx("li",{children:"• Room history cannot be recovered"})]})]})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(A,{htmlFor:"confirmation",children:["Type ",e.jsx("strong",{children:s})," to confirm deletion:"]}),e.jsx(U,{id:"confirmation",value:o,onChange:h=>i(h.target.value),placeholder:`Type "${s}" here`,className:"font-mono"})]})]}),e.jsxs(Ke,{children:[e.jsx(He,{onClick:()=>{i(""),r(!1)},disabled:d.isPending,children:"Cancel"}),e.jsx(Ve,{onClick:f,disabled:!p||d.isPending,className:"bg-red-600 hover:bg-red-700 focus:ring-red-600",children:d.isPending?"Deleting...":"Delete Room"})]})]})]})}function Kn({roomId:a,roomName:s,isAuthor:t,room:n}){const[r,o]=l.useState(!1),[i,c]=l.useState(!1),[d,f]=l.useState(!1),[p,h]=l.useState(!1),{user:b}=S(),w=Z(),{data:T,isLoading:E,error:j}=en(a),u=Ya(),k=sn(),M=async()=>{try{await u.mutateAsync(a),c(!1),o(!1),w({to:"/chat"})}catch(R){console.error("Failed to leave room:",R)}},P=R=>new Date(R).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),$=R=>R.isOnline?"Online":"Offline",me=async(R,be)=>{if(confirm(`Are you sure you want to remove ${be} from this room?`))try{await k.mutateAsync({roomId:a,memberId:R})}catch(we){console.error("Failed to remove member:",we)}},ue=async()=>{try{await navigator.clipboard.writeText(s),f(!0),setTimeout(()=>f(!1),2e3)}catch(R){console.error("Failed to copy room name:",R)}},he=async()=>{try{await navigator.clipboard.writeText(a),h(!0),setTimeout(()=>h(!1),2e3)}catch(R){console.error("Failed to copy room ID:",R)}};return e.jsxs(e.Fragment,{children:[e.jsxs(ve,{open:r,onOpenChange:o,children:[e.jsx(Ms,{asChild:!0,children:e.jsx(m,{variant:"ghost",size:"sm",children:e.jsx(Xe,{className:"w-4 h-4"})})}),e.jsxs(ie,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(le,{children:[e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(Xe,{className:"w-5 h-5"}),"Room Settings"]}),e.jsxs(de,{children:["Manage ",s," settings and members"]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Room Information"}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"Name:"}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[e.jsx("p",{className:"flex-1",children:T?.roomInfo.name}),e.jsx(m,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:ue,title:"Copy room name",children:d?e.jsx(ne,{className:"w-3 h-3 text-green-600"}):e.jsx(ke,{className:"w-3 h-3"})})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"Created:"}),e.jsx("p",{className:"mt-1",children:T?.roomInfo.createdAt&&P(T.roomInfo.createdAt)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"Total Members:"}),e.jsx("p",{className:"mt-1",children:T?.totalMembers||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"Online Members:"}),e.jsx("p",{className:"mt-1 text-green-600",children:T?.members.filter(R=>R.isOnline).length||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"Room ID:"}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[e.jsx("p",{className:"flex-1 font-mono text-xs text-gray-500 break-all",children:a}),e.jsx(m,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 flex-shrink-0",onClick:he,title:"Copy room ID",children:p?e.jsx(ne,{className:"w-3 h-3 text-green-600"}):e.jsx(ke,{className:"w-3 h-3"})})]})]})]})})]}),e.jsx(ts,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(je,{className:"w-5 h-5"}),"Members (",T?.totalMembers||0,")"]})}),E&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Loading members..."}),j&&e.jsx("div",{className:"text-center py-8 text-red-500",children:"Failed to load members"}),T?.members&&e.jsx("div",{className:"space-y-3 max-h-60 overflow-y-auto",children:T.members.map(R=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(Y,{className:"w-10 h-10",children:[e.jsx(X,{src:R.avatarUrl}),e.jsx(ee,{children:R.username.charAt(0).toUpperCase()})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:R.username}),R.isAuthor&&e.jsxs(ge,{variant:"secondary",className:"text-xs",children:[e.jsx(Kt,{className:"w-3 h-3 mr-1"}),"Owner"]}),R.id===b?.id&&e.jsx(ge,{variant:"outline",className:"text-xs",children:"You"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500",children:[e.jsx("span",{children:R.email}),e.jsx("span",{children:"•"}),e.jsx("span",{className:R.isOnline?"text-green-600":"text-gray-400",children:$(R)}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:["Joined ",P(R.joinedAt)]})]})]})]}),t&&R.id!==b?.id&&!R.isAuthor&&e.jsx("div",{className:"flex items-center gap-1",children:e.jsx(m,{variant:"ghost",size:"sm",className:"text-red-600 hover:text-red-700",onClick:()=>me(R.id,R.username),disabled:k.isPending,title:`Remove ${R.username} from room`,children:e.jsx(_t,{className:"w-4 h-4"})})})]},R.id))})]}),e.jsx(ts,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Actions"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[t&&n&&e.jsxs(e.Fragment,{children:[e.jsx(Bn,{room:n}),e.jsx(Qn,{roomId:a,roomName:s})]}),!t&&e.jsxs(m,{variant:"outline",className:"justify-start text-red-600 hover:text-red-700",onClick:()=>c(!0),disabled:u.isPending,children:[e.jsx(Fe,{className:"w-4 h-4 mr-2"}),u.isPending?"Leaving...":"Leave Room"]})]})]})]})]})]}),e.jsx(ze,{open:i,onOpenChange:c,children:e.jsxs(Be,{children:[e.jsxs(Qe,{children:[e.jsxs(_e,{className:"flex items-center gap-2",children:[e.jsx(Te,{className:"w-5 h-5 text-orange-500"}),"Leave Room"]}),e.jsxs(Je,{children:['Are you sure you want to leave "',s,`"? You won't be able to see new messages unless someone invites you back.`]})]}),e.jsxs(Ke,{children:[e.jsx(He,{children:"Cancel"}),e.jsx(Ve,{onClick:M,className:"bg-red-600 hover:bg-red-700",disabled:u.isPending,children:u.isPending?"Leaving...":"Leave Room"})]})]})})]})}const Bs=l.createContext({connected:!1,socketId:null,connectionError:null}),Qs=()=>{const a=l.useContext(Bs);if(!a)throw new Error("useSocket must be used within a SocketProvider");return a};function _n({children:a}){const{isAuthenticated:s,tokens:t}=S(),[n,r]=l.useState(C.connected),[o,i]=l.useState(C.socketId),[c,d]=l.useState(null);l.useEffect(()=>{s&&t?.accessToken?(console.log("SocketProvider: User authenticated, connecting socket..."),(async()=>{try{d(null),await C.connect()}catch(h){console.error("SocketProvider: Failed to connect socket:",h),d(h instanceof Error?h.message:"Connection failed")}})()):(console.log("SocketProvider: User not authenticated, disconnecting socket..."),C.disconnect())},[s,t?.accessToken]),l.useEffect(()=>C.onConnectionChange(h=>{console.log("SocketProvider: Connection state changed:",h),r(h),i(C.socketId),h&&d(null)}),[]),l.useEffect(()=>()=>{console.log("SocketProvider: Cleaning up socket connection"),C.disconnect()},[]);const f={connected:n,socketId:o,connectionError:c};return e.jsx(Bs.Provider,{value:f,children:a})}const Jn=fe("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-card text-card-foreground",destructive:"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90"}},defaultVariants:{variant:"default"}});function as({className:a,variant:s,...t}){return e.jsx("div",{"data-slot":"alert",role:"alert",className:x(Jn({variant:s}),a),...t})}function ns({className:a,...s}){return e.jsx("div",{"data-slot":"alert-description",className:x("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",a),...s})}function Vn(){const{connected:a,connectionError:s}=Qs();return a&&!s?null:e.jsx("div",{className:"fixed top-4 right-4 z-50 max-w-sm",children:s?e.jsxs(as,{variant:"destructive",children:[e.jsx(As,{className:"h-4 w-4"}),e.jsxs(ns,{children:["Connection Error: ",s]})]}):a?null:e.jsxs(as,{variant:"default",className:"border-yellow-200 bg-yellow-50",children:[e.jsx(Es,{className:"h-4 w-4 text-yellow-600"}),e.jsx(ns,{className:"text-yellow-800",children:"Connecting to chat server..."})]})})}function Hn(){const{connected:a,connectionError:s}=Qs();return a&&!s?e.jsxs("div",{className:"flex items-center text-green-600 text-sm",children:[e.jsx(Jt,{className:"h-3 w-3 mr-1"}),e.jsx("span",{children:"Connected"})]}):s?e.jsxs("div",{className:"flex items-center text-red-600 text-sm",children:[e.jsx(As,{className:"h-3 w-3 mr-1"}),e.jsx("span",{children:"Connection Error"})]}):e.jsxs("div",{className:"flex items-center text-yellow-600 text-sm",children:[e.jsx(Es,{className:"h-3 w-3 mr-1"}),e.jsx("span",{children:"Connecting..."})]})}function Ks({roomId:a}){const[s,t]=l.useState(!1),{setCurrentRoom:n,joinRoom:r,messagesByRoom:o}=ye(),{connected:i}=gn(),{user:c}=S(),{data:d,isLoading:f,error:p}=Va(a),{data:h,isLoading:b,hasNextPage:w,fetchNextPage:T,isFetchingNextPage:E}=tn(a);rn(a),on(a),ln(),dn(a),un(a),hn(),xn();const j=o[a]||[],u=h?.pages.flatMap(P=>P.messages)||[],k=new Map;u.forEach(P=>{k.set(P.id,P)}),j.forEach(P=>{k.set(P.id,P)});const M=Array.from(k.values()).sort((P,$)=>new Date(P.createdAt).getTime()-new Date($.createdAt).getTime());return l.useEffect(()=>(n(a),i&&r(a),()=>{n(null)}),[a,i,n,r]),p?e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-red-600 mb-2",children:"Failed to load room"}),e.jsx(m,{variant:"outline",onClick:()=>window.location.reload(),children:"Retry"})]})}):f?e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsx("div",{className:"text-gray-500",children:"Loading room..."})}):d?e.jsxs("div",{className:"h-full flex flex-col bg-white",children:[e.jsxs("div",{className:"sticky top-0 z-10 flex items-center justify-between p-4 border-b bg-gray-50 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(Y,{className:"w-10 h-10",children:[e.jsx(X,{src:d.avatarUrl}),e.jsx(ee,{children:d.name.charAt(0).toUpperCase()})]}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-semibold text-gray-900",children:d.name}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[e.jsx(je,{className:"w-4 h-4"}),e.jsxs("span",{children:[d.participants.length," members"]}),e.jsx("span",{children:"•"}),e.jsx(Hn,{})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[c&&d.authorId===c.id&&e.jsx(m,{size:"sm",variant:"ghost",className:"h-8 w-8 p-0",onClick:()=>t(!0),title:"Invite users to this room",children:e.jsx(Se,{className:"w-4 h-4"})}),e.jsx(m,{size:"sm",variant:"ghost",className:"h-8 w-8 p-0",children:e.jsx(Vt,{className:"w-4 h-4"})}),e.jsx(m,{size:"sm",variant:"ghost",className:"h-8 w-8 p-0",children:e.jsx(Ht,{className:"w-4 h-4"})}),e.jsx(Kn,{roomId:a,roomName:d.name,isAuthor:c?.id===d.authorId,room:d})]})]}),!i&&e.jsx("div",{className:"sticky top-[73px] z-10 bg-yellow-50 border-b border-yellow-200 px-4 py-2",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-yellow-800",children:[e.jsx("div",{className:"w-2 h-2 bg-yellow-500 rounded-full animate-pulse"}),e.jsx("span",{children:"Reconnecting to chat..."})]})}),e.jsx(Dn,{roomId:a,messages:M,isLoading:b||E,hasNextPage:w,onLoadMore:()=>T()}),e.jsx(Fn,{roomId:a,disabled:!i,placeholder:i?"Type a message...":"Connecting to chat..."}),e.jsx(zn,{open:s,onOpenChange:t,roomId:a,roomName:d.name})]}):e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsx("div",{className:"text-gray-500",children:"Room not found"})})}const Gn=J("/chat")({beforeLoad:({location:a})=>{if(!S.getState().isAuthenticated)throw pe({to:"/login",search:{redirect:a.href}})},component:Wn});function Wn(){const[a,s]=l.useState(null),t=Z(),n=r=>{s(r),t({to:"/room/$id",params:{id:r}}).catch(()=>{s(r)})};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(se,{title:"Chat"}),e.jsxs("div",{className:"h-[calc(100vh-4rem)] flex",children:[e.jsx("div",{className:"w-80 flex-shrink-0",children:e.jsx(Nn,{onRoomSelect:n,selectedRoomId:a||void 0})}),e.jsx("div",{className:"flex-1",children:a?e.jsx(Ks,{roomId:a}):e.jsx("div",{className:"h-full flex items-center justify-center bg-white",children:e.jsxs("div",{className:"text-center text-gray-500",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})})}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Select a room to start chatting"}),e.jsx("p",{className:"text-sm",children:"Choose a room from the sidebar to begin your conversation"})]})})})]})]})}const Zn=J("/404")({component:Yn});function Yn(){return e.jsxs("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 relative",children:[e.jsx(g,{to:"/",className:"absolute top-4 left-4",children:e.jsxs(m,{variant:"ghost",size:"sm",children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),"Back to Home"]})}),e.jsxs("div",{className:"max-w-md mx-auto text-center",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("div",{className:"text-8xl mb-4",children:"🔍"}),e.jsx("h1",{className:"text-6xl font-bold text-gray-900 mb-4",children:"404"}),e.jsx("h2",{className:"text-2xl font-semibold text-gray-700 mb-2",children:"Page Not Found"}),e.jsx("p",{className:"text-gray-600 mb-8",children:"Oops! The page you're looking for doesn't exist. It might have been moved, deleted, or you entered the wrong URL."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(g,{to:"/",children:e.jsxs(m,{className:"w-full",children:[e.jsx(ds,{className:"w-4 h-4 mr-2"}),"Go to Homepage"]})}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(g,{to:"/todo",className:"flex-1",children:e.jsx(m,{variant:"outline",className:"w-full",children:"Todo App"})}),e.jsx(g,{to:"/chat",className:"flex-1",children:e.jsx(m,{variant:"outline",className:"w-full",children:"Chat Rooms"})})]})]})]})]})}const Xn=J("/")({component:er});function er(){const{isAuthenticated:a}=S(),s=[{icon:e.jsx(Gt,{className:"w-8 h-8"}),title:"Modern Tech Stack",description:"Built with React, TypeScript, TanStack Router, and TailwindCSS",color:"bg-blue-500"},{icon:e.jsx(Wt,{className:"w-8 h-8"}),title:"Full Stack Ready",description:"Complete MERN stack with MongoDB, Express, React, and Node.js",color:"bg-green-500"},{icon:e.jsx(Zt,{className:"w-8 h-8"}),title:"High Performance",description:"Optimized for speed with modern bundling and state management",color:"bg-yellow-500"},{icon:e.jsx(Yt,{className:"w-8 h-8"}),title:"Responsive Design",description:"Beautiful UI that works perfectly on all devices",color:"bg-purple-500"}],t=[{title:"Todo Manager",description:"Organize your tasks efficiently with our intuitive todo application",icon:e.jsx(Xt,{className:"w-6 h-6"}),link:"/todo",color:"from-blue-500 to-blue-600"},{title:"Chat Rooms",description:"Connect with others in real-time chat rooms",icon:e.jsx(ea,{className:"w-6 h-6"}),link:"/chat",color:"from-green-500 to-green-600"},{title:"User Profile",description:"Manage your account settings and preferences",icon:e.jsx(je,{className:"w-6 h-6"}),link:"/profile",color:"from-purple-500 to-purple-600"}];return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100",children:[e.jsx(se,{transparent:!0}),e.jsx("div",{className:"relative overflow-hidden",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-24",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ge,{variant:"secondary",className:"mb-4",children:"🚀 Modern Full Stack Application"}),e.jsxs("h1",{className:"text-4xl md:text-6xl font-bold text-gray-900 mb-6",children:["Welcome to"," ",e.jsx("span",{className:"bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"MERN Stack"})]}),e.jsx("p",{className:"text-xl text-gray-600 mb-8 max-w-3xl mx-auto",children:"A modern, full-featured web application built with the latest technologies. Experience the power of React, TanStack Router, shadcn/ui, and TailwindCSS."}),e.jsx("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:a?e.jsxs(e.Fragment,{children:[e.jsx(g,{to:"/todo",children:e.jsxs(m,{size:"lg",className:"w-full sm:w-auto",children:["Try Todo App",e.jsx(Re,{className:"ml-2 w-4 h-4"})]})}),e.jsx(g,{to:"/chat",children:e.jsx(m,{variant:"outline",size:"lg",className:"w-full sm:w-auto",children:"Join Chat Rooms"})})]}):e.jsxs(e.Fragment,{children:[e.jsx(g,{search:{redirect:"/todo"},to:"/login",children:e.jsxs(m,{size:"lg",className:"w-full sm:w-auto",children:["Sign In to Get Started",e.jsx(Re,{className:"ml-2 w-4 h-4"})]})}),e.jsx(g,{to:"/register",children:e.jsx(m,{variant:"outline",size:"lg",className:"w-full sm:w-auto",children:"Create Account"})})]})}),!a&&e.jsxs("div",{className:"mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg max-w-md mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-2 text-blue-800",children:[e.jsx(es,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Authentication Required"})]}),e.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"Sign in to access Todo Manager, Chat Rooms, and Profile features."})]})]})})}),e.jsx("div",{className:"py-24 bg-white",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"text-center mb-16",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Built with Modern Technologies"}),e.jsx("p",{className:"text-lg text-gray-600 max-w-2xl mx-auto",children:"Our application leverages the latest and greatest technologies to provide you with the best possible experience."})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8",children:s.map((n,r)=>e.jsxs(q,{className:"text-center hover:shadow-lg transition-shadow",children:[e.jsxs(Q,{children:[e.jsx("div",{className:`w-16 h-16 ${n.color} rounded-lg flex items-center justify-center text-white mx-auto mb-4`,children:n.icon}),e.jsx(K,{className:"text-lg",children:n.title})]}),e.jsx(z,{children:e.jsx(G,{children:n.description})})]},r))})]})}),e.jsx("div",{className:"py-24 bg-gray-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"text-center mb-16",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Explore Our Applications"}),e.jsx("p",{className:"text-lg text-gray-600 max-w-2xl mx-auto",children:"Discover the powerful applications we've built to showcase the capabilities of our modern tech stack."})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:t.map((n,r)=>e.jsxs(q,{className:"hover:shadow-lg transition-all duration-300 hover:-translate-y-1",children:[e.jsxs(Q,{children:[e.jsx("div",{className:`w-12 h-12 bg-gradient-to-r ${n.color} rounded-lg flex items-center justify-center text-white mb-4`,children:n.icon}),e.jsx(K,{className:"text-xl",children:n.title}),e.jsx(G,{children:n.description})]}),e.jsx(z,{children:a?e.jsx(g,{to:n.link,children:e.jsxs(m,{className:"w-full",children:["Try it now",e.jsx(Re,{className:"ml-2 w-4 h-4"})]})}):e.jsx(g,{search:{redirect:n.link},to:"/login",children:e.jsxs(m,{variant:"outline",className:"w-full",children:[e.jsx(es,{className:"w-4 h-4 mr-2"}),"Sign in to access"]})})})]},r))})]})}),e.jsx("footer",{className:"bg-gray-900 text-white py-12",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-8",children:[e.jsxs("div",{className:"col-span-1 md:col-span-2",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-sm",children:"MS"})}),e.jsx("span",{className:"ml-3 text-xl font-semibold",children:"MERN Stack"})]}),e.jsx("p",{className:"text-gray-400 mb-4",children:"A modern full-stack application showcasing the power of React, TanStack Router, and modern web technologies."})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Applications"}),e.jsxs("ul",{className:"space-y-2",children:[e.jsx("li",{children:e.jsx(g,{to:"/todo",className:"text-gray-400 hover:text-white",children:"Todo Manager"})}),e.jsx("li",{children:e.jsx(g,{to:"/chat",className:"text-gray-400 hover:text-white",children:"Chat Rooms"})}),e.jsx("li",{children:e.jsx(g,{to:"/profile",className:"text-gray-400 hover:text-white",children:"User Profile"})})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Account"}),e.jsxs("ul",{className:"space-y-2",children:[e.jsx("li",{children:e.jsx(g,{to:"/login",className:"text-gray-400 hover:text-white",search:{redirect:"/todo"},children:"Sign In"})}),e.jsx("li",{children:e.jsx(g,{to:"/register",className:"text-gray-400 hover:text-white",children:"Sign Up"})}),e.jsx("li",{children:e.jsx(g,{to:"/forgot-password",className:"text-gray-400 hover:text-white",children:"Forgot Password"})})]})]})]}),e.jsx("div",{className:"border-t border-gray-800 mt-8 pt-8 text-center",children:e.jsx("p",{className:"text-gray-400",children:"© 2025 MERN Stack App. Built with ❤️ using modern web technologies."})})]})})]})}const sr=J("/room/$id")({beforeLoad:({location:a})=>{if(!S.getState().isAuthenticated)throw pe({to:"/login",search:{redirect:a.href}})},component:tr});function tr(){const{id:a}=sa({from:"/room/$id"});return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b px-4 py-3 sticky top-0 z-50",children:e.jsxs("div",{className:"max-w-4xl mx-auto flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center space-x-3",children:e.jsx(g,{to:"/chat",children:e.jsxs(m,{variant:"ghost",size:"sm",children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),"Back to Chat"]})})}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(g,{to:"/",children:e.jsx(m,{variant:"outline",size:"sm",children:"Home"})})})]})}),e.jsx("div",{className:"h-[calc(100vh-4rem)]",children:e.jsx(Ks,{roomId:a})})]})}const ar=da.update({id:"/verify-otp",path:"/verify-otp",getParentRoute:()=>_}),nr=Ea.update({id:"/todo",path:"/todo",getParentRoute:()=>_}),rr=Ma.update({id:"/register",path:"/register",getParentRoute:()=>_}),or=$a.update({id:"/profile",path:"/profile",getParentRoute:()=>_}),ir=Oa.update({id:"/login",path:"/login",getParentRoute:()=>_}),lr=za.update({id:"/forgot-password",path:"/forgot-password",getParentRoute:()=>_}),cr=Gn.update({id:"/chat",path:"/chat",getParentRoute:()=>_}),dr=Zn.update({id:"/404",path:"/404",getParentRoute:()=>_}),mr=Xn.update({id:"/",path:"/",getParentRoute:()=>_}),ur=sr.update({id:"/room/$id",path:"/room/$id",getParentRoute:()=>_}),hr={IndexRoute:mr,R404Route:dr,ChatRoute:cr,ForgotPasswordRoute:lr,LoginRoute:ir,ProfileRoute:or,RegisterRoute:rr,TodoRoute:nr,VerifyOtpRoute:ar,RoomIdRoute:ur},xr=_._addFileChildren(hr)._addFileTypes(),gr=new ta({defaultOptions:{queries:{staleTime:60*1e3,gcTime:10*60*1e3,retry:(a,s)=>s?.status>=400&&s?.status<500&&![408,429].includes(s?.status)?!1:a<3,refetchOnWindowFocus:!1},mutations:{retry:(a,s)=>s?.status>=400&&s?.status<500&&![408,429].includes(s?.status)?!1:a<2}}}),fr=aa({routeTree:xr}),rs=document.getElementById("root");rs.innerHTML||na.createRoot(rs).render(e.jsx(l.StrictMode,{children:e.jsx(ra,{client:gr,children:e.jsxs(_n,{children:[e.jsx(oa,{router:fr}),e.jsx(Vn,{}),e.jsx(ia,{initialIsOpen:!1})]})})}));
