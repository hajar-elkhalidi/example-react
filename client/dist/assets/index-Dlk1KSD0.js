import{c as Xe,j as e,R as be,O as es,T as ss,t as ts,a as as,r as c,S as rs,b as ge,d as ke,e as B,u as Te,L as m,A as Q,C as Ce,f as ns,g as os,h as Re,p as is,i as M,k as q,l as te,m as ls,H as Se,U as cs,n as Le,o as ee,q as ae,P as Pe,s as ds,v as Ae,w as ms,x as fe,y as Me,I as Fe,F as Ee,z as us,B as hs,D as xs,E as gs,G as fs,J as De,K as ps,M as Ue,N as ys,X as js,Q as $e,V as Oe,W as vs,Y as Ns,Z as ws,_ as bs,$ as ks,a0 as je,a1 as Ts,a2 as Cs,a3 as Rs,a4 as Ss,a5 as Ls,a6 as Be,a7 as pe,a8 as Ps,a9 as As,aa as Ms,ab as Fs,ac as Es,ad as Ds,ae as Us,af as $s,ag as ce,ah as ve,ai as Os,aj as Bs,ak as qs,al as Is,am as zs,an as Qs,ao as Ks,ap as Hs,aq as Js,ar as Vs,as as _s,at as Gs,au as Zs}from"./vendor-5VskBG3y.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function s(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(n){if(n.ep)return;n.ep=!0;const o=s(n);fetch(n.href,o)}})();const O=Xe({component:()=>e.jsxs(be.Fragment,{children:[e.jsx(es,{}),e.jsx(ss,{})]})});function g(...a){return ts(as(a))}const Ws=ge("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),d=c.forwardRef(({className:a,variant:t,size:s,asChild:r=!1,...n},o)=>{const i=r?rs:"button";return e.jsx(i,{className:g(Ws({variant:t,size:s,className:a})),ref:o,...n})});d.displayName="Button";const P=c.forwardRef(({className:a,...t},s)=>e.jsx("div",{ref:s,className:g("rounded-xl border bg-card text-card-foreground shadow",a),...t}));P.displayName="Card";const U=c.forwardRef(({className:a,...t},s)=>e.jsx("div",{ref:s,className:g("flex flex-col space-y-1.5 p-6",a),...t}));U.displayName="CardHeader";const $=c.forwardRef(({className:a,...t},s)=>e.jsx("div",{ref:s,className:g("font-semibold leading-none tracking-tight",a),...t}));$.displayName="CardTitle";const z=c.forwardRef(({className:a,...t},s)=>e.jsx("div",{ref:s,className:g("text-sm text-muted-foreground",a),...t}));z.displayName="CardDescription";const A=c.forwardRef(({className:a,...t},s)=>e.jsx("div",{ref:s,className:g("p-6 pt-0",a),...t}));A.displayName="CardContent";const Ys=c.forwardRef(({className:a,...t},s)=>e.jsx("div",{ref:s,className:g("flex items-center p-6 pt-0",a),...t}));Ys.displayName="CardFooter";const k=c.forwardRef(({className:a,type:t,...s},r)=>e.jsx("input",{type:t,className:g("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:r,...s}));k.displayName="Input";const Xs=ge("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),S=c.forwardRef(({className:a,...t},s)=>e.jsx(ke,{ref:s,className:g(Xs(),a),...t}));S.displayName=ke.displayName;const et=B("/verify-otp")({component:st,validateSearch:a=>({e:a.e||""})});function st(){const a=Te({from:"/verify-otp"}),[t,s]=c.useState(""),r=()=>{console.log("Verifying OTP:",t,"for email:",a.e)};return e.jsxs("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 relative",children:[e.jsx(m,{to:"/forgot-password",className:"absolute top-4 left-4",children:e.jsxs(d,{variant:"ghost",size:"sm",children:[e.jsx(Q,{className:"w-4 h-4 mr-2"}),"Back"]})}),e.jsxs(P,{className:"w-full max-w-md",children:[e.jsxs(U,{className:"text-center",children:[e.jsx($,{className:"text-2xl",children:"Verify OTP"}),e.jsxs(z,{children:["Enter the 6-digit code sent to ",a.e||"your email"]})]}),e.jsxs(A,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"otp",children:"OTP Code"}),e.jsx(k,{id:"otp",type:"text",placeholder:"Enter 6-digit code",value:t,onChange:n=>s(n.target.value),maxLength:6,className:"text-center text-lg tracking-widest",required:!0})]}),e.jsx(d,{className:"w-full",onClick:r,disabled:t.length!==6,children:"Verify OTP"}),e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx(m,{to:"/forgot-password",className:"text-sm text-blue-600 hover:underline",children:"Resend Code"}),e.jsx("div",{children:e.jsx(m,{to:"/login",search:{redirect:"/"},className:"text-sm text-blue-600 hover:underline",children:"Back to Sign In"})})]})]})]})]})}const qe=c.forwardRef(({className:a,...t},s)=>e.jsx(Ce,{ref:s,className:g("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",a),...t,children:e.jsx(ns,{className:g("flex items-center justify-center text-current"),children:e.jsx(os,{className:"h-4 w-4"})})}));qe.displayName=Ce.displayName;const w=Re()(is((a,t)=>({user:null,isAuthenticated:!1,tokens:null,setUser:s=>{a({user:s})},setAuthenticated:s=>{a({isAuthenticated:s})},setTokens:s=>{a({tokens:s})},logout:()=>{a({user:null,isAuthenticated:!1,tokens:null})},login:async(s,r)=>(await new Promise(n=>setTimeout(n,1e3)),s==="demo@example.com"&&r==="password"?(a({user:{id:"1",name:"Demo User",email:"demo@example.com",avatar:"/api/placeholder/120/120"},isAuthenticated:!0}),!0):!1),register:async(s,r,n)=>{await new Promise(i=>setTimeout(i,1e3));const o={id:Date.now().toString(),name:s,email:r,avatar:"/api/placeholder/120/120"};return a({user:o,isAuthenticated:!0}),!0}}),{name:"auth-storage",partialize:a=>({user:a.user,isAuthenticated:a.isAuthenticated,tokens:a.tokens})})),tt={apiBaseUrl:"http://localhost:5000/api"};class at{baseURL;accessToken=null;refreshToken=null;constructor(t=tt.apiBaseUrl){this.baseURL=t,this.loadTokensFromStorage(),console.log("HTTP Client initialized:",{baseURL:this.baseURL,hasAccessToken:!!this.accessToken,hasRefreshToken:!!this.refreshToken})}loadTokensFromStorage(){try{const t=localStorage.getItem("auth-storage");if(t){const s=JSON.parse(t),r=s.state?.tokens||s.tokens;this.accessToken=r?.accessToken||null,this.refreshToken=r?.refreshToken||null,console.log("Loading tokens from storage:",{hasAuthData:!!t,hasState:!!s.state,hasTokens:!!r,hasAccessToken:!!this.accessToken})}}catch(t){console.warn("Failed to load tokens from storage:",t)}}saveTokensToStorage(t,s){this.accessToken=t,this.refreshToken=s;try{let r=localStorage.getItem("auth-storage"),n;r?n=JSON.parse(r):n={state:{user:null,isAuthenticated:!1,tokens:null},version:0},n.state||(n.state={}),n.state.tokens={accessToken:t,refreshToken:s},t&&(n.state.isAuthenticated=!0),localStorage.setItem("auth-storage",JSON.stringify(n)),console.log("Saved tokens to localStorage:",{hasAccessToken:!!t,hasRefreshToken:!!s,accessTokenPreview:t?`${t.substring(0,20)}...`:null,fullStructure:n});const o=localStorage.getItem("auth-storage");if(o){const i=JSON.parse(o);console.log("Verification - tokens in storage:",{hasTokens:!!i.state?.tokens,hasAccessToken:!!i.state?.tokens?.accessToken})}}catch(r){console.error("Failed to save tokens to storage:",r)}}clearTokens(){this.accessToken=null,this.refreshToken=null;try{const t=localStorage.getItem("auth-storage");if(t){const s=JSON.parse(t);delete s.state.tokens,localStorage.setItem("auth-storage",JSON.stringify(s))}}catch(t){console.warn("Failed to clear tokens from storage:",t)}}syncTokensFromAuthStore(){try{const t=localStorage.getItem("auth-storage");if(t){const r=JSON.parse(t).state?.tokens;if(r?.accessToken&&r?.refreshToken)return this.accessToken=r.accessToken,this.refreshToken=r.refreshToken,console.log("Synced tokens from authStore:",{hasAccessToken:!!this.accessToken,accessTokenLength:this.accessToken?.length}),!0}}catch(t){console.warn("Failed to sync tokens from authStore:",t)}return!1}async request(t,s={}){this.accessToken||this.syncTokensFromAuthStore();const r=`${this.baseURL}${t}`,n={"Content-Type":"application/json",...s.headers};this.accessToken?(n.Authorization=`Bearer ${this.accessToken}`,console.log("Adding Authorization header:",`Bearer ${this.accessToken.substring(0,20)}...`)):console.warn("No access token available for request to:",t),console.log("this.accessToken",this.accessToken);try{const o=await fetch(r,{...s,headers:n}),i=await o.json();if(!o.ok){if(o.status===401&&this.refreshToken&&t!=="/auth/refresh")try{return await this.refreshAccessToken(),this.request(t,s)}catch{throw this.clearTokens(),new X("Session expired. Please login again.",401)}throw new X(i.message||`HTTP ${o.status}: ${o.statusText}`,o.status,i.errors)}return i}catch(o){throw o instanceof X?o:new X(o instanceof Error?o.message:"Network error occurred",0)}}async refreshAccessToken(){if(!this.refreshToken)throw new Error("No refresh token available");try{const t=await fetch(`${this.baseURL}/auth/refresh`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:this.refreshToken})});if(!t.ok)throw new Error(`Failed to refresh token: ${t.status}`);const s=await t.json();if(!s.success||!s.data?.tokens)throw new Error("Invalid refresh token response");const{accessToken:r,refreshToken:n}=s.data.tokens;this.saveTokensToStorage(r,n)}catch(t){throw this.clearTokens(),t}}async get(t){return this.request(t,{method:"GET"})}async post(t,s){return this.request(t,{method:"POST",body:s?JSON.stringify(s):void 0})}async put(t,s){return this.request(t,{method:"PUT",body:s?JSON.stringify(s):void 0})}async delete(t){return this.request(t,{method:"DELETE"})}setTokens(t,s){this.saveTokensToStorage(t,s)}reloadTokens(){this.loadTokensFromStorage()}forceSetTokens(t,s){console.log("Force setting tokens:",{hasAccessToken:!!t,hasRefreshToken:!!s}),this.accessToken=t,this.refreshToken=s}clearAuth(){this.clearTokens()}}class X extends Error{constructor(t,s,r){super(t),this.status=s,this.errors=r,this.name="ApiError"}}const x=new at;class rt{async login(t){const s=await x.post("/auth/login",t);if(s.success&&s.data)return console.log("Login successful, storing tokens:",{hasAccessToken:!!s.data.tokens.accessToken,hasRefreshToken:!!s.data.tokens.refreshToken,accessTokenLength:s.data.tokens.accessToken?.length}),x.setTokens(s.data.tokens.accessToken,s.data.tokens.refreshToken),s.data;throw new Error(s.message||"Login failed")}async register(t){const s=await x.post("/auth/register",t);if(s.success&&s.data)return x.setTokens(s.data.tokens.accessToken,s.data.tokens.refreshToken),s.data;throw new Error(s.message||"Registration failed")}async logout(){try{await x.post("/auth/logout")}catch(t){console.warn("Logout request failed:",t)}finally{x.clearAuth()}}async getCurrentUser(){const t=await x.get("/auth/me");if(t.success&&t.data)return t.data;throw new Error(t.message||"Failed to get user profile")}async forgotPassword(t){const s=await x.post("/auth/forgot-password",t);if(s.success&&s.data)return s.data;throw new Error(s.message||"Failed to send reset email")}async verifyOtp(t){const s=await x.post("/auth/verify-otp",t);if(!s.success)throw new Error(s.message||"OTP verification failed")}async resetPassword(t){const s=await x.post("/auth/reset-password",t);if(!s.success)throw new Error(s.message||"Password reset failed")}async changePassword(t){const s=await x.post("/auth/change-password",t);if(!s.success)throw new Error(s.message||"Password change failed")}isAuthenticated(){try{const t=localStorage.getItem("auth-storage");if(t){const s=JSON.parse(t);return s.state?.isAuthenticated===!0&&s.state?.tokens?.accessToken}}catch(t){console.warn("Failed to check authentication status:",t)}return!1}}const re=new rt,J={all:["auth"],me:()=>[...J.all,"me"]},nt=()=>{const{isAuthenticated:a}=w();return te({queryKey:J.me(),queryFn:re.getCurrentUser,enabled:a,staleTime:5*60*1e3,retry:(t,s)=>s?.status===401?!1:t<3})},ot=()=>{const a=M(),{setUser:t,setAuthenticated:s,setTokens:r}=w();return q({mutationFn:n=>re.login(n),onSuccess:n=>{console.log("Login mutation onSuccess, received data:",{hasUser:!!n.user,hasTokens:!!n.tokens,accessTokenLength:n.tokens?.accessToken?.length}),t({id:n.user.id,name:n.user.username,email:n.user.email,avatar:n.user.avatarUrl}),s(!0),r(n.tokens),x.forceSetTokens(n.tokens.accessToken,n.tokens.refreshToken),x.setTokens(n.tokens.accessToken,n.tokens.refreshToken),a.setQueryData(J.me(),n.user),a.invalidateQueries({queryKey:J.all})},onError:n=>{console.error("Login failed:",n)}})},it=()=>{const a=M(),{setUser:t,setAuthenticated:s,setTokens:r}=w();return q({mutationFn:n=>re.register(n),onSuccess:n=>{t({id:n.user.id,name:n.user.username,email:n.user.email,avatar:n.user.avatarUrl}),s(!0),r(n.tokens),a.setQueryData(J.me(),n.user),a.invalidateQueries({queryKey:J.all})},onError:n=>{console.error("Registration failed:",n)}})},Ie=()=>{const a=M(),{logout:t}=w();return q({mutationFn:re.logout,onSuccess:()=>{t(),a.clear()},onError:s=>{console.error("Logout failed:",s),t(),a.clear()}})};function H({showBackButton:a=!1,title:t,transparent:s=!1}){const r=ls(),{isAuthenticated:n,user:o}=w(),i=Ie(),l=p=>r.pathname===p,u=()=>{i.mutate()};return e.jsxs("nav",{className:`${s?"bg-white/95 backdrop-blur-sm":"bg-white"} shadow-sm border-b sticky top-0 z-50`,children:[e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center h-16",children:[e.jsxs("div",{className:"flex items-center",children:[a&&e.jsx(m,{to:"/",className:"mr-4",children:e.jsxs(d,{variant:"ghost",size:"sm",children:[e.jsx(Q,{className:"w-4 h-4 mr-2"}),"Back"]})}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-sm",children:"MS"})})}),e.jsx("div",{className:"ml-3",children:e.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:t||"MERN Stack"})})]})]}),e.jsx("div",{className:"hidden md:block",children:e.jsxs("div",{className:"ml-10 flex items-baseline space-x-4",children:[e.jsxs(m,{to:"/",className:`px-3 py-2 rounded-md text-sm font-medium transition-colors ${l("/")?"text-blue-600 bg-blue-50":"text-gray-600 hover:text-blue-600"}`,children:[e.jsx(Se,{className:"w-4 h-4 inline mr-1"}),"Home"]}),e.jsx(m,{to:"/todo",className:`px-3 py-2 rounded-md text-sm font-medium transition-colors ${l("/todo")?"text-blue-600 bg-blue-50":"text-gray-600 hover:text-blue-600"}`,children:"Todo"}),e.jsx(m,{to:"/chat",className:`px-3 py-2 rounded-md text-sm font-medium transition-colors ${l("/chat")?"text-blue-600 bg-blue-50":"text-gray-600 hover:text-blue-600"}`,children:"Chat"}),e.jsx(m,{to:"/profile",className:`px-3 py-2 rounded-md text-sm font-medium transition-colors ${l("/profile")?"text-blue-600 bg-blue-50":"text-gray-600 hover:text-blue-600"}`,children:"Profile"})]})}),e.jsx("div",{className:"flex items-center space-x-4",children:n?e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:["Welcome, ",o?.name]}),e.jsx(m,{to:"/profile",children:e.jsxs(d,{variant:"outline",size:"sm",children:[e.jsx(cs,{className:"w-4 h-4 mr-2"}),"Profile"]})}),e.jsxs(d,{variant:"outline",size:"sm",onClick:u,disabled:i.isPending,children:[e.jsx(Le,{className:"w-4 h-4 mr-2"}),i.isPending?"Signing Out...":"Sign Out"]})]}):e.jsxs(e.Fragment,{children:[e.jsx(m,{to:"/login",search:{redirect:"/"},children:e.jsx(d,{variant:"outline",size:"sm",children:"Sign In"})}),e.jsx(m,{to:"/register",children:e.jsx(d,{size:"sm",children:"Get Started"})})]})})]})}),e.jsx("div",{className:"md:hidden",children:e.jsxs("div",{className:"px-2 pt-2 pb-3 space-y-1 sm:px-3 border-t",children:[e.jsx(m,{to:"/",className:`block px-3 py-2 rounded-md text-base font-medium transition-colors ${l("/")?"text-blue-600 bg-blue-50":"text-gray-600 hover:text-blue-600"}`,children:"Home"}),e.jsx(m,{to:"/todo",className:`block px-3 py-2 rounded-md text-base font-medium transition-colors ${l("/todo")?"text-blue-600 bg-blue-50":"text-gray-600 hover:text-blue-600"}`,children:"Todo"}),e.jsx(m,{to:"/chat",className:`block px-3 py-2 rounded-md text-base font-medium transition-colors ${l("/chat")?"text-blue-600 bg-blue-50":"text-gray-600 hover:text-blue-600"}`,children:"Chat"}),e.jsx(m,{to:"/profile",className:`block px-3 py-2 rounded-md text-base font-medium transition-colors ${l("/profile")?"text-blue-600 bg-blue-50":"text-gray-600 hover:text-blue-600"}`,children:"Profile"})]})})]})}class lt{async getTodos(t){const s=new URLSearchParams;t?.page&&s.append("page",t.page.toString()),t?.limit&&s.append("limit",t.limit.toString()),t?.status&&s.append("status",t.status),t?.sortBy&&s.append("sortBy",t.sortBy),t?.sortOrder&&s.append("sortOrder",t.sortOrder);const r=s.toString(),n=`/todos${r?`?${r}`:""}`,o=await x.get(n);if(o.success&&o.data)return o.data;throw new Error(o.message||"Failed to fetch todos")}async getTodoById(t){const s=await x.get(`/todos/${t}`);if(s.success&&s.data)return s.data;throw new Error(s.message||"Failed to fetch todo")}async createTodo(t){const s=await x.post("/todos",t);if(s.success&&s.data)return s.data.todo;throw new Error(s.message||"Failed to create todo")}async updateTodo(t,s){const r=await x.put(`/todos/${t}`,s);if(r.success&&r.data)return r.data.todo;throw new Error(r.message||"Failed to update todo")}async updateTodoStatus(t,s){const r=await x.put(`/todos/${t}`,s);if(r.success&&r.data)return r.data.todo;throw new Error(r.message||"Failed to update todo status")}async deleteTodo(t){const s=await x.delete(`/todos/${t}`);if(!s.success)throw new Error(s.message||"Failed to delete todo")}}const ne=new lt,D={all:["todos"],lists:()=>[...D.all,"list"],list:a=>[...D.lists(),a],details:()=>[...D.all,"detail"],detail:a=>[...D.details(),a]},ct=a=>te({queryKey:D.list(a),queryFn:()=>ne.getTodos(a),staleTime:30*1e3,retry:(t,s)=>s?.status===401?!1:t<3}),dt=()=>{const a=M();return q({mutationFn:t=>ne.createTodo(t),onSuccess:t=>{a.invalidateQueries({queryKey:D.lists()}),a.setQueryData(D.detail(t.id),t)},onError:t=>{console.error("Failed to create todo:",t)}})},mt=()=>{const a=M();return q({mutationFn:({id:t,data:s})=>ne.updateTodoStatus(t,s),onSuccess:t=>{a.setQueryData(D.detail(t.id),t),a.invalidateQueries({queryKey:D.lists()})},onError:t=>{console.error("Failed to update todo status:",t)}})},ut=()=>{const a=M();return q({mutationFn:t=>ne.deleteTodo(t),onSuccess:(t,s)=>{a.removeQueries({queryKey:D.detail(s)}),a.invalidateQueries({queryKey:D.lists()})},onError:t=>{console.error("Failed to delete todo:",t)}})};var E=(a=>(a.INITIAL="initial",a.IN_PROGRESS="in_progress",a.COMPLETED="completed",a.CANCELLED="cancelled",a))(E||{});const ht=({size:a="md",className:t})=>{const s={sm:"w-4 h-4",md:"w-6 h-6",lg:"w-8 h-8"};return e.jsx(ee,{className:g("animate-spin",s[a],t)})},xt=({message:a="Loading...",size:t="md",className:s})=>e.jsxs("div",{className:g("flex items-center justify-center py-8",s),children:[e.jsx(ht,{size:t}),e.jsx("span",{className:"ml-2 text-gray-600",children:a})]}),gt=({message:a="Something went wrong",error:t,onRetry:s,className:r})=>e.jsxs("div",{className:g("text-center py-8 text-red-600",r),children:[e.jsx("p",{className:"font-medium",children:a}),t?.message&&e.jsx("p",{className:"text-sm mt-2 text-red-500",children:t.message}),s&&e.jsx("button",{onClick:s,className:"mt-4 px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors",children:"Try Again"})]}),ft=({message:a="No data found",description:t,icon:s,action:r,className:n})=>e.jsxs("div",{className:g("text-center py-8 text-gray-500",n),children:[s&&e.jsx("div",{className:"mb-4",children:s}),e.jsx("p",{className:"font-medium",children:a}),t&&e.jsx("p",{className:"text-sm mt-2",children:t}),r&&e.jsx("div",{className:"mt-4",children:r})]}),pt=B("/todo")({beforeLoad:({context:a,location:t})=>{if(!w.getState().isAuthenticated)throw ae({to:"/login",search:{redirect:t.href}})},component:yt});function yt(){const[a,t]=c.useState(""),[s,r]=c.useState(""),[n,o]=c.useState(""),[i,l]=c.useState(void 0),[u,p]=c.useState("createdAt"),[f,T]=c.useState("desc"),v=c.useMemo(()=>({status:i,sortBy:u,sortOrder:f,limit:50}),[i,u,f]),{data:N,isLoading:y,error:F,refetch:V}=ct(v),j=dt(),C=mt(),L=ut(),I=()=>a.trim()?a.trim().length<3?(o("Title must be at least 3 characters long"),!1):a.trim().length>200?(o("Title must be less than 200 characters"),!1):s.trim().length>2e3?(o("Content must be less than 2000 characters"),!1):(o(""),!0):(o("Title is required"),!1),_=h=>{h.preventDefault(),I()&&j.mutate({title:a.trim(),content:s.trim()||a.trim()},{onSuccess:()=>{t(""),r(""),o("")},onError:G=>{o(G.message||"Failed to create todo")}})},We=(h,G)=>{const le=G===E.COMPLETED?E.INITIAL:E.COMPLETED;C.mutate({id:h,data:{status:le}})},Ye=h=>{confirm("Are you sure you want to delete this todo?")&&L.mutate(h)};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(H,{title:"Todo App"}),e.jsx("div",{className:"py-8",children:e.jsxs("div",{className:"max-w-2xl mx-auto px-4",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Todo Manager"}),e.jsx("p",{className:"text-gray-600",children:"Organize your tasks and boost productivity"})]}),e.jsxs(P,{className:"mb-6",children:[e.jsx(U,{children:e.jsx($,{children:"Add New Task"})}),e.jsx(A,{children:e.jsxs("form",{onSubmit:_,className:"space-y-4",children:[(n||j.error)&&e.jsx("div",{className:"p-3 text-sm text-red-600 bg-red-50 border border-red-200 rounded-md",children:n||j.error?.message||"Failed to create todo"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(k,{placeholder:"Enter task title...",value:a,onChange:h=>{t(h.target.value),n&&o("")},className:"flex-1",required:!0,maxLength:200}),e.jsx(d,{type:"submit",disabled:j.isPending||!a.trim(),children:j.isPending?e.jsx(ee,{className:"w-4 h-4 animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(Pe,{className:"w-4 h-4 mr-2"}),"Add Task"]})})]}),e.jsx(k,{placeholder:"Enter task description (optional)...",value:s,onChange:h=>r(h.target.value),maxLength:2e3}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Title: ",a.length,"/200 characters",s&&` • Description: ${s.length}/2000 characters`]})]})})]}),e.jsxs(P,{children:[e.jsx(U,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx($,{children:"Your Tasks"}),N&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[N.total," total • ",N.todos.filter(h=>h.status===E.COMPLETED).length," completed"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsxs("select",{value:i||"",onChange:h=>l(h.target.value||void 0),className:"px-2 py-1 border rounded",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:E.INITIAL,children:"Initial"}),e.jsx("option",{value:E.IN_PROGRESS,children:"In Progress"}),e.jsx("option",{value:E.COMPLETED,children:"Completed"}),e.jsx("option",{value:E.CANCELLED,children:"Cancelled"})]}),e.jsxs("select",{value:`${u}-${f}`,onChange:h=>{const[G,le]=h.target.value.split("-");p(G),T(le)},className:"px-2 py-1 border rounded",children:[e.jsx("option",{value:"createdAt-desc",children:"Newest First"}),e.jsx("option",{value:"createdAt-asc",children:"Oldest First"}),e.jsx("option",{value:"title-asc",children:"Title A-Z"}),e.jsx("option",{value:"title-desc",children:"Title Z-A"}),e.jsx("option",{value:"status-asc",children:"Status A-Z"})]})]})]})}),e.jsx(A,{children:y?e.jsx(xt,{message:"Loading tasks..."}):F?e.jsx(gt,{message:"Failed to load tasks",error:F,onRetry:()=>V()}):N?.todos&&N.todos.length>0?e.jsx("div",{className:"space-y-3",children:N.todos.map(h=>e.jsxs("div",{className:"flex items-center space-x-3 p-3 border rounded-lg",children:[e.jsx(qe,{id:`task-${h.id}`,checked:h.status===E.COMPLETED,onCheckedChange:()=>We(h.id,h.status),disabled:C.isPending}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{htmlFor:`task-${h.id}`,className:`block text-sm font-medium ${h.status===E.COMPLETED?"line-through text-gray-500":"text-gray-900"}`,children:h.title}),h.content!==h.title&&e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:h.content}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["Created: ",new Date(h.createdAt).toLocaleDateString()]})]}),e.jsx(d,{variant:"outline",size:"sm",onClick:()=>{alert("Edit functionality coming soon!")},children:e.jsx(ds,{className:"w-4 h-4"})}),e.jsx(d,{variant:"destructive",size:"sm",onClick:()=>Ye(h.id),disabled:L.isPending,children:e.jsx(Ae,{className:"w-4 h-4"})})]},h.id))}):e.jsx(ft,{message:"No tasks yet",description:"Create your first task above to get started!",icon:e.jsx(ms,{className:"w-12 h-12 mx-auto text-gray-400"})})})]})]})})]})}const jt=B("/register")({component:vt});function vt(){const a=fe(),t=it(),[s,r]=c.useState({username:"",email:"",password:"",confirmPassword:""}),[n,o]=c.useState(""),i=async l=>{if(l.preventDefault(),o(""),s.password!==s.confirmPassword){o("Passwords do not match");return}t.mutate({username:s.username,email:s.email,password:s.password},{onSuccess:()=>{a({to:"/"})},onError:u=>{o(u.message||"Registration failed. Please try again.")}})};return e.jsxs("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 relative",children:[e.jsx(m,{to:"/",className:"absolute top-4 left-4",children:e.jsxs(d,{variant:"ghost",size:"sm",children:[e.jsx(Q,{className:"w-4 h-4 mr-2"}),"Back to Home"]})}),e.jsxs(P,{className:"w-full max-w-md",children:[e.jsxs(U,{className:"text-center",children:[e.jsx($,{className:"text-2xl",children:"Sign Up"}),e.jsx(z,{children:"Create a new account to get started"})]}),e.jsxs(A,{children:[e.jsxs("form",{onSubmit:i,className:"space-y-4",children:[(n||t.error)&&e.jsx("div",{className:"p-3 text-sm text-red-600 bg-red-50 border border-red-200 rounded-md",children:n||t.error?.message||"Registration failed. Please try again."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"username",children:"Username"}),e.jsx(k,{id:"username",type:"text",placeholder:"Enter your username",value:s.username,onChange:l=>r({...s,username:l.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"email",children:"Email"}),e.jsx(k,{id:"email",type:"email",placeholder:"Enter your email",value:s.email,onChange:l=>r({...s,email:l.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"password",children:"Password"}),e.jsx(k,{id:"password",type:"password",placeholder:"Enter your password",value:s.password,onChange:l=>r({...s,password:l.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"confirmPassword",children:"Confirm Password"}),e.jsx(k,{id:"confirmPassword",type:"password",placeholder:"Confirm your password",value:s.confirmPassword,onChange:l=>r({...s,confirmPassword:l.target.value}),required:!0})]}),e.jsx(d,{type:"submit",className:"w-full",disabled:t.isPending,children:t.isPending?"Creating Account...":"Sign Up"})]}),e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"text-sm text-gray-600",children:["Already have an account?"," ",e.jsx(m,{to:"/login",className:"text-blue-600 hover:underline",search:{redirect:"/"},children:"Sign in"})]})})]})]})]})}const Z=c.forwardRef(({className:a,...t},s)=>e.jsx(Me,{ref:s,className:g("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",a),...t}));Z.displayName=Me.displayName;const W=c.forwardRef(({className:a,...t},s)=>e.jsx(Fe,{ref:s,className:g("aspect-square h-full w-full",a),...t}));W.displayName=Fe.displayName;const Y=c.forwardRef(({className:a,...t},s)=>e.jsx(Ee,{ref:s,className:g("flex h-full w-full items-center justify-center rounded-full bg-muted",a),...t}));Y.displayName=Ee.displayName;const Nt=B("/profile")({beforeLoad:({context:a,location:t})=>{if(!w.getState().isAuthenticated)throw ae({to:"/login",search:{redirect:t.href}})},component:wt});function wt(){const{user:a}=w(),{data:t,isLoading:s,error:r}=nt(),n=Ie(),[o,i]=c.useState({name:"",email:"",bio:"Software developer passionate about creating amazing user experiences.",avatar:""});be.useEffect(()=>{t&&i({name:t.username||"",email:t.email||"",bio:"Software developer passionate about creating amazing user experiences.",avatar:t.avatarUrl||"/api/placeholder/120/120"})},[t]);const l=()=>{console.log("Saving profile:",o),alert("Profile update functionality coming soon!")},u=()=>{console.log("Change avatar clicked"),alert("Avatar upload functionality coming soon!")},p=()=>{n.mutate()};return s?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(H,{title:"My Profile"}),e.jsx("div",{className:"py-8",children:e.jsx("div",{className:"max-w-2xl mx-auto px-4",children:e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(ee,{className:"w-6 h-6 animate-spin"}),e.jsx("span",{className:"ml-2",children:"Loading profile..."})]})})})]}):r?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(H,{title:"My Profile"}),e.jsx("div",{className:"py-8",children:e.jsx("div",{className:"max-w-2xl mx-auto px-4",children:e.jsxs("div",{className:"text-center py-8 text-red-600",children:[e.jsx("p",{children:"Failed to load profile. Please try again."}),e.jsx("p",{className:"text-sm mt-2",children:r.message})]})})})]}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(H,{title:"My Profile"}),e.jsx("div",{className:"py-8",children:e.jsxs("div",{className:"max-w-2xl mx-auto px-4",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"My Profile"}),e.jsx("p",{className:"text-gray-600",children:"Manage your account settings and preferences"})]}),e.jsxs(P,{children:[e.jsx(U,{children:e.jsx($,{children:"Profile Information"})}),e.jsxs(A,{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsxs(Z,{className:"w-24 h-24",children:[e.jsx(W,{src:o.avatar}),e.jsx(Y,{className:"text-lg",children:o.name.split(" ").map(f=>f[0]).join("")})]}),e.jsx(d,{size:"sm",variant:"outline",className:"absolute -bottom-2 -right-2 rounded-full w-8 h-8 p-0",onClick:u,children:e.jsx(us,{className:"w-4 h-4"})})]}),e.jsx(d,{variant:"outline",onClick:u,children:"Change Avatar"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"name",children:"Full Name"}),e.jsx(k,{id:"name",value:o.name,onChange:f=>i({...o,name:f.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"email",children:"Email"}),e.jsx(k,{id:"email",type:"email",value:o.email,onChange:f=>i({...o,email:f.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"bio",children:"Bio"}),e.jsx("textarea",{id:"bio",className:"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",value:o.bio,onChange:f=>i({...o,bio:f.target.value}),placeholder:"Tell us about yourself..."})]})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsxs(d,{onClick:l,className:"flex items-center gap-2",children:[e.jsx(hs,{className:"w-4 h-4"}),"Save Changes"]})})]})]}),e.jsxs(P,{className:"mt-6",children:[e.jsx(U,{children:e.jsx($,{children:"Account Settings"})}),e.jsxs(A,{className:"space-y-4",children:[e.jsx(d,{variant:"outline",className:"w-full",children:"Change Password"}),e.jsx(d,{variant:"outline",className:"w-full",children:"Privacy Settings"}),e.jsxs(d,{variant:"outline",className:"w-full flex items-center gap-2",onClick:p,disabled:n.isPending,children:[n.isPending?e.jsx(ee,{className:"w-4 h-4 animate-spin"}):e.jsx(Le,{className:"w-4 h-4"}),"Sign Out"]}),e.jsx(d,{variant:"destructive",className:"w-full",children:"Delete Account"})]})]})]})})]})}const bt=B("/login")({validateSearch:a=>({redirect:a.redirect||"/"}),component:kt});function kt(){const a=fe(),t=Te({from:"/login"}),s=ot(),[r,n]=c.useState({email:"",password:""}),o=async i=>{i.preventDefault(),s.mutate(r,{onSuccess:()=>{a({to:t.redirect})},onError:l=>{console.error("Login error:",l)}})};return e.jsxs("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 relative",children:[e.jsx(m,{to:"/",className:"absolute top-4 left-4",children:e.jsxs(d,{variant:"ghost",size:"sm",children:[e.jsx(Q,{className:"w-4 h-4 mr-2"}),"Back to Home"]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(P,{className:"w-full max-w-md bg-blue-50 border-blue-200",children:e.jsx(A,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"Demo Account"}),e.jsx("p",{className:"text-sm text-blue-700 mb-3",children:"Use these credentials to test the application:"}),e.jsxs("div",{className:"bg-white p-3 rounded border text-left",children:[e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Email:"})," demo@example.com"]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Password:"})," password"]})]})]})})}),e.jsxs(P,{className:"w-full max-w-md",children:[e.jsxs(U,{className:"text-center",children:[e.jsx($,{className:"text-2xl",children:"Sign In"}),e.jsx(z,{children:"Sign in to your account to continue"})]}),e.jsxs(A,{children:[e.jsxs("form",{onSubmit:o,className:"space-y-4",children:[s.error&&e.jsx("div",{className:"p-3 text-sm text-red-600 bg-red-50 border border-red-200 rounded-md",children:s.error.message||"Login failed. Please try again."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"email",children:"Email"}),e.jsx(k,{id:"email",type:"email",placeholder:"demo@example.com",value:r.email,onChange:i=>n({...r,email:i.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"password",children:"Password"}),e.jsx(k,{id:"password",type:"password",placeholder:"password",value:r.password,onChange:i=>n({...r,password:i.target.value}),required:!0})]}),e.jsx(d,{type:"submit",className:"w-full",disabled:s.isPending,children:s.isPending?"Signing In...":"Sign In"})]}),e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx(m,{to:"/forgot-password",className:"text-sm text-blue-600 hover:underline",children:"Forgot password?"}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Don't have an account?"," ",e.jsx(m,{to:"/register",className:"text-blue-600 hover:underline",children:"Sign up"})]})]})]})]})]})]})}const Tt=B("/forgot-password")({component:Ct});function Ct(){return e.jsxs("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 relative",children:[e.jsx(m,{to:"/login",search:{redirect:"/"},className:"absolute top-4 left-4",children:e.jsxs(d,{variant:"ghost",size:"sm",children:[e.jsx(Q,{className:"w-4 h-4 mr-2"}),"Back to Login"]})}),e.jsxs(P,{className:"w-full max-w-md",children:[e.jsxs(U,{className:"text-center",children:[e.jsx($,{className:"text-2xl",children:"Forgot Password"}),e.jsx(z,{children:"Enter your email to reset your password"})]}),e.jsxs(A,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"email",children:"Email"}),e.jsx(k,{id:"email",type:"email",placeholder:"Enter your email",required:!0})]}),e.jsx(d,{className:"w-full",children:"Send Reset Link"}),e.jsx("div",{className:"text-center",children:e.jsx(m,{to:"/login",search:{redirect:"/"},className:"text-sm text-blue-600 hover:underline",children:"Back to Sign In"})})]})]})]})}const Rt=ge("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function se({className:a,variant:t,...s}){return e.jsx("div",{className:g(Rt({variant:t}),a),...s})}class St{socket=null;isConnected=!1;reconnectAttempts=0;maxReconnectAttempts=5;reconnectDelay=1e3;messageListeners=[];messageUpdateListeners=[];messageDeleteListeners=[];typingListeners=[];userJoinedListeners=[];userLeftListeners=[];connectionListeners=[];connect(){return new Promise((t,s)=>{try{const n=w.getState().tokens?.accessToken;if(!n){s(new Error("No authentication token available"));return}this.socket=xs("http://localhost:5000",{auth:{token:n},transports:["websocket","polling"],timeout:1e4}),this.socket.on("connect",()=>{console.log("Socket connected:",this.socket?.id),this.isConnected=!0,this.reconnectAttempts=0,this.notifyConnectionListeners(!0),t()}),this.socket.on("disconnect",o=>{console.log("Socket disconnected:",o),this.isConnected=!1,this.notifyConnectionListeners(!1),o!=="io server disconnect"&&this.handleReconnect()}),this.socket.on("connect_error",o=>{console.error("Socket connection error:",o),this.isConnected=!1,this.notifyConnectionListeners(!1),this.reconnectAttempts===0&&s(o),this.handleReconnect()}),this.socket.on("new-message",o=>{this.notifyMessageListeners(o.message)}),this.socket.on("message-updated",o=>{this.notifyMessageUpdateListeners(o)}),this.socket.on("message-deleted",o=>{this.notifyMessageDeleteListeners(o)}),this.socket.on("user-typing",o=>{this.notifyTypingListeners(o)}),this.socket.on("user-joined",o=>{this.notifyUserJoinedListeners(o)}),this.socket.on("user-left",o=>{this.notifyUserLeftListeners(o)}),this.socket.on("error",o=>{console.error("Socket error:",o)})}catch(r){s(r)}})}disconnect(){this.socket&&(this.socket.disconnect(),this.socket=null,this.isConnected=!1,this.notifyConnectionListeners(!1))}handleReconnect(){if(this.reconnectAttempts>=this.maxReconnectAttempts){console.error("Max reconnection attempts reached");return}this.reconnectAttempts++;const t=this.reconnectDelay*Math.pow(2,this.reconnectAttempts-1);console.log(`Attempting to reconnect in ${t}ms (attempt ${this.reconnectAttempts}/${this.maxReconnectAttempts})`),setTimeout(()=>{this.isConnected||this.connect().catch(console.error)},t)}joinRoom(t){if(this.socket&&this.isConnected){const s=w.getState();this.socket.emit("join-room",{roomId:t,userId:s.user?.id})}}leaveRoom(t){if(this.socket&&this.isConnected){const s=w.getState();this.socket.emit("leave-room",{roomId:t,userId:s.user?.id})}}sendMessage(t,s){this.socket&&this.isConnected&&this.socket.emit("send-message",{roomId:t,content:s})}sendTyping(t,s){if(this.socket&&this.isConnected){const r=w.getState();this.socket.emit("typing",{roomId:t,userId:r.user?.id,username:r.user?.name,isTyping:s})}}onNewMessage(t){return this.messageListeners.push(t),()=>{this.messageListeners=this.messageListeners.filter(s=>s!==t)}}onMessageUpdate(t){return this.messageUpdateListeners.push(t),()=>{this.messageUpdateListeners=this.messageUpdateListeners.filter(s=>s!==t)}}onMessageDelete(t){return this.messageDeleteListeners.push(t),()=>{this.messageDeleteListeners=this.messageDeleteListeners.filter(s=>s!==t)}}onTyping(t){return this.typingListeners.push(t),()=>{this.typingListeners=this.typingListeners.filter(s=>s!==t)}}onUserJoined(t){return this.userJoinedListeners.push(t),()=>{this.userJoinedListeners=this.userJoinedListeners.filter(s=>s!==t)}}onUserLeft(t){return this.userLeftListeners.push(t),()=>{this.userLeftListeners=this.userLeftListeners.filter(s=>s!==t)}}onConnectionChange(t){return this.connectionListeners.push(t),()=>{this.connectionListeners=this.connectionListeners.filter(s=>s!==t)}}notifyMessageListeners(t){this.messageListeners.forEach(s=>s(t))}notifyMessageUpdateListeners(t){this.messageUpdateListeners.forEach(s=>s(t))}notifyMessageDeleteListeners(t){this.messageDeleteListeners.forEach(s=>s(t))}notifyTypingListeners(t){this.typingListeners.forEach(s=>s(t))}notifyUserJoinedListeners(t){this.userJoinedListeners.forEach(s=>s(t))}notifyUserLeftListeners(t){this.userLeftListeners.forEach(s=>s(t))}notifyConnectionListeners(t){this.connectionListeners.forEach(s=>s(t))}get connected(){return this.isConnected}get socketId(){return this.socket?.id}}const R=new St,oe=Re()(gs((a,t)=>({currentRoomId:null,isConnected:!1,rooms:[],messagesByRoom:{},typingUsersByRoom:{},isTyping:{},typingTimeouts:{},setCurrentRoom:s=>{a({currentRoomId:s}),s&&t().clearUnreadCount(s)},setConnected:s=>{a({isConnected:s})},setRooms:s=>{a({rooms:s})},addRoom:s=>{a(r=>({rooms:[s,...r.rooms.filter(n=>n.id!==s.id)]}))},updateRoom:(s,r)=>{a(n=>({rooms:n.rooms.map(o=>o.id===s?{...o,...r}:o)}))},removeRoom:s=>{a(r=>{const n={...r.messagesByRoom};delete n[s];const o={...r.typingUsersByRoom};return delete o[s],{rooms:r.rooms.filter(i=>i.id!==s),messagesByRoom:n,typingUsersByRoom:o,currentRoomId:r.currentRoomId===s?null:r.currentRoomId}})},setMessages:(s,r)=>{a(n=>({messagesByRoom:{...n.messagesByRoom,[s]:r}}))},addMessage:s=>{a(i=>{const u=(i.messagesByRoom[s.roomId]||[]).filter(p=>!(p.isOptimistic&&p.content===s.content&&Math.abs(new Date(p.createdAt).getTime()-new Date(s.createdAt).getTime())<5e3));return{messagesByRoom:{...i.messagesByRoom,[s.roomId]:[s,...u]}}});const{currentRoomId:r,updateLastActivity:n,incrementUnreadCount:o}=t();n(s.roomId),r!==s.roomId&&o(s.roomId)},addOptimisticMessage:s=>{const r=`temp-${Date.now()}-${Math.random()}`,n={...s,id:r,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),isOptimistic:!0};return a(o=>({messagesByRoom:{...o.messagesByRoom,[s.roomId]:[n,...o.messagesByRoom[s.roomId]||[]]}})),r},updateMessage:(s,r)=>{a(n=>{const o={...n.messagesByRoom};return Object.keys(o).forEach(i=>{o[i]=o[i].map(l=>l.id===s?{...l,...r}:l)}),{messagesByRoom:o}})},removeMessage:s=>{a(r=>{const n={...r.messagesByRoom};return Object.keys(n).forEach(o=>{n[o]=n[o].filter(i=>i.id!==s)}),{messagesByRoom:n}})},markMessageError:(s,r)=>{t().updateMessage(s,{error:r,isOptimistic:!1})},setTyping:(s,r)=>{const n=t();if(n.typingTimeouts[s]&&clearTimeout(n.typingTimeouts[s]),R.sendTyping(s,r),r){const o=window.setTimeout(()=>{t().setTyping(s,!1)},3e3);a(i=>({isTyping:{...i.isTyping,[s]:!0},typingTimeouts:{...i.typingTimeouts,[s]:o}}))}else a(o=>{const i={...o.isTyping};delete i[s];const l={...o.typingTimeouts};return delete l[s],{isTyping:i,typingTimeouts:l}})},addTypingUser:s=>{a(r=>({typingUsersByRoom:{...r.typingUsersByRoom,[s.roomId]:[...(r.typingUsersByRoom[s.roomId]||[]).filter(n=>n.userId!==s.userId),s]}}))},removeTypingUser:(s,r)=>{a(n=>({typingUsersByRoom:{...n.typingUsersByRoom,[r]:(n.typingUsersByRoom[r]||[]).filter(o=>o.userId!==s)}}))},clearTypingUsers:s=>{a(r=>({typingUsersByRoom:{...r.typingUsersByRoom,[s]:[]}}))},incrementUnreadCount:s=>{a(r=>({rooms:r.rooms.map(n=>n.id===s?{...n,unreadCount:(n.unreadCount||0)+1}:n)}))},clearUnreadCount:s=>{a(r=>({rooms:r.rooms.map(n=>n.id===s?{...n,unreadCount:0}:n)}))},updateLastActivity:s=>{const r=new Date().toISOString();a(n=>({rooms:n.rooms.map(o=>o.id===s?{...o,lastActivity:r}:o)}))},sendMessage:(s,r)=>{t().addOptimisticMessage({content:r,roomId:s,authorId:"",author:{id:"",username:"",avatarUrl:""}}),R.sendMessage(s,r),t().updateLastActivity(s)},joinRoom:s=>{R.joinRoom(s)},leaveRoom:s=>{R.leaveRoom(s)},cleanup:()=>{const s=t();Object.values(s.typingTimeouts).forEach(r=>{clearTimeout(r)}),a({currentRoomId:null,isConnected:!1,rooms:[],messagesByRoom:{},typingUsersByRoom:{},isTyping:{},typingTimeouts:{}})}}),{name:"chat-store"}));class Lt{baseUrl="/api/chat";async getRooms(t=1,s=10){return(await x.get(`${this.baseUrl}/rooms?page=${t}&limit=${s}`)).data?.data||{rooms:[],total:0,page:1,limit:10,totalPages:0}}async getRoom(t){return(await x.get(`${this.baseUrl}/rooms/${t}`)).data?.data?.room||{}}async createRoom(t){return(await x.post(`${this.baseUrl}/rooms`,t)).data?.data?.room||{}}async updateRoom(t,s){return(await x.put(`${this.baseUrl}/rooms/${t}`,s)).data?.data?.room||{}}async deleteRoom(t){await x.delete(`${this.baseUrl}/rooms/${t}`)}async joinRoom(t){return(await x.post(`${this.baseUrl}/rooms/${t}/join`)).data?.data?.room||{}}async leaveRoom(t){await x.post(`${this.baseUrl}/rooms/${t}/leave`)}async getMessages(t,s=1,r=50){return(await x.get(`${this.baseUrl}/rooms/${t}/messages?page=${s}&limit=${r}`)).data?.data||{messages:[],total:0,page:1,limit:50,totalPages:0}}async updateMessage(t,s,r){return(await x.put(`${this.baseUrl}/rooms/${t}/messages/${s}`,r)).data?.data?.message||{}}async deleteMessage(t,s){await x.delete(`${this.baseUrl}/rooms/${t}/messages/${s}`)}}const K=new Lt,b={all:["chat"],rooms:()=>[...b.all,"rooms"],room:a=>[...b.all,"room",a],messages:a=>[...b.all,"messages",a]};function Pt(a=1,t=10){return te({queryKey:[...b.rooms(),a,t],queryFn:()=>K.getRooms(a,t),staleTime:5*60*1e3})}function At(a){return te({queryKey:b.room(a),queryFn:()=>K.getRoom(a),enabled:!!a,staleTime:5*60*1e3})}function Mt(){const a=M();return q({mutationFn:t=>K.createRoom(t),onSuccess:()=>{a.invalidateQueries({queryKey:b.rooms()})}})}function Ft(){const a=M();return q({mutationFn:t=>K.joinRoom(t),onSuccess:(t,s)=>{a.setQueryData(b.room(s),t),a.invalidateQueries({queryKey:b.rooms()}),R.joinRoom(s)}})}function Et(a,t=50){return fs({queryKey:[...b.messages(a),"infinite"],queryFn:({pageParam:s=1})=>K.getMessages(a,s,t),enabled:!!a,initialPageParam:1,getNextPageParam:s=>{if(s.page<s.totalPages)return s.page+1},staleTime:1*60*1e3})}function Dt(a){const t=M();return q({mutationFn:({messageId:s,data:r})=>K.updateMessage(a,s,r),onSuccess:()=>{t.invalidateQueries({queryKey:b.messages(a)})}})}function Ut(a){const t=M();return q({mutationFn:s=>K.deleteMessage(a,s),onSuccess:()=>{t.invalidateQueries({queryKey:b.messages(a)})}})}function $t(a){const t=M(),s=c.useCallback(o=>{o.roomId===a&&(t.setQueryData([...b.messages(a),"infinite"],i=>{if(!i)return i;const l=[...i.pages];return l.length>0&&(l[0]={...l[0],messages:[o,...l[0].messages],total:l[0].total+1}),{...i,pages:l}}),t.invalidateQueries({queryKey:b.messages(a)}))},[t,a]),r=c.useCallback(o=>{o.roomId===a&&t.setQueryData([...b.messages(a),"infinite"],i=>{if(!i)return i;const l=i.pages.map(u=>({...u,messages:u.messages.map(p=>p.id===o.messageId?{...p,content:o.content,updatedAt:new Date().toISOString()}:p)}));return{...i,pages:l}})},[t,a]),n=c.useCallback(o=>{o.roomId===a&&t.setQueryData([...b.messages(a),"infinite"],i=>{if(!i)return i;const l=i.pages.map(u=>({...u,messages:u.messages.filter(p=>p.id!==o.messageId),total:Math.max(0,u.total-1)}));return{...i,pages:l}})},[t,a]);c.useEffect(()=>{if(!a)return;const o=R.onNewMessage(s),i=R.onMessageUpdate(r),l=R.onMessageDelete(n);return()=>{o(),i(),l()}},[a,s,r,n])}function ye(){const a=M();return c.useEffect(()=>((async()=>{try{R.connected||await R.connect()}catch(s){console.error("Failed to connect to socket:",s)}})(),()=>{R.disconnect()}),[]),c.useEffect(()=>R.onConnectionChange(s=>{s&&a.invalidateQueries({queryKey:b.all})}),[a]),{connected:R.connected,socketId:R.socketId}}const Ot=vs,Bt=ps,ze=c.forwardRef(({className:a,...t},s)=>e.jsx(De,{ref:s,className:g("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...t}));ze.displayName=De.displayName;const Qe=c.forwardRef(({className:a,children:t,...s},r)=>e.jsxs(Bt,{children:[e.jsx(ze,{}),e.jsxs(Ue,{ref:r,className:g("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...s,children:[t,e.jsxs(ys,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(js,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Qe.displayName=Ue.displayName;const Ke=({className:a,...t})=>e.jsx("div",{className:g("flex flex-col space-y-1.5 text-center sm:text-left",a),...t});Ke.displayName="DialogHeader";const He=({className:a,...t})=>e.jsx("div",{className:g("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",a),...t});He.displayName="DialogFooter";const Je=c.forwardRef(({className:a,...t},s)=>e.jsx($e,{ref:s,className:g("text-lg font-semibold leading-none tracking-tight",a),...t}));Je.displayName=$e.displayName;const Ve=c.forwardRef(({className:a,...t},s)=>e.jsx(Oe,{ref:s,className:g("text-sm text-muted-foreground",a),...t}));Ve.displayName=Oe.displayName;const qt=ws,_e=c.createContext({}),Ne=({...a})=>e.jsx(_e.Provider,{value:{name:a.name},children:e.jsx(bs,{...a})}),ie=()=>{const a=c.useContext(_e),t=c.useContext(Ge),{getFieldState:s,formState:r}=Ns(),n=s(a.name,r);if(!a)throw new Error("useFormField should be used within <FormField>");const{id:o}=t;return{id:o,name:a.name,formItemId:`${o}-form-item`,formDescriptionId:`${o}-form-item-description`,formMessageId:`${o}-form-item-message`,...n}},Ge=c.createContext({}),de=c.forwardRef(({className:a,...t},s)=>{const r=c.useId();return e.jsx(Ge.Provider,{value:{id:r},children:e.jsx("div",{ref:s,className:g("space-y-2",a),...t})})});de.displayName="FormItem";const me=c.forwardRef(({className:a,...t},s)=>{const{error:r,formItemId:n}=ie();return e.jsx(S,{ref:s,className:g(r&&"text-destructive",a),htmlFor:n,...t})});me.displayName="FormLabel";const ue=c.forwardRef(({...a},t)=>{const{error:s,formItemId:r,formDescriptionId:n,formMessageId:o}=ie();return e.jsx("div",{ref:t,id:r,"aria-describedby":s?`${n} ${o}`:`${n}`,"aria-invalid":!!s,...a})});ue.displayName="FormControl";const he=c.forwardRef(({className:a,...t},s)=>{const{formDescriptionId:r}=ie();return e.jsx("p",{ref:s,id:r,className:g("text-sm text-muted-foreground",a),...t})});he.displayName="FormDescription";const xe=c.forwardRef(({className:a,children:t,...s},r)=>{const{error:n,formMessageId:o}=ie(),i=n?String(n?.message):t;return i?e.jsx("p",{ref:r,id:o,className:g("text-sm font-medium text-destructive",a),...s,children:i}):null});xe.displayName="FormMessage";const It=ks({name:je().min(1,"Room name is required").max(100,"Room name must be less than 100 characters").regex(/^[a-zA-Z0-9\s\-_]+$/,"Room name can only contain letters, numbers, spaces, hyphens, and underscores"),avatarUrl:je().url("Must be a valid URL").optional().or(Ts(""))});function zt({open:a,onOpenChange:t}){const s=Mt(),r=Cs({resolver:Rs(It),defaultValues:{name:"",avatarUrl:""}}),n=async i=>{try{await s.mutateAsync({name:i.name,avatarUrl:i.avatarUrl||void 0}),t(!1),r.reset()}catch(l){console.error("Failed to create room:",l)}},o=()=>{s.isPending||(t(!1),r.reset())};return e.jsx(Ot,{open:a,onOpenChange:o,children:e.jsxs(Qe,{className:"sm:max-w-[425px]",children:[e.jsxs(Ke,{children:[e.jsx(Je,{children:"Create New Room"}),e.jsx(Ve,{children:"Create a new chat room to start conversations with your team."})]}),e.jsx(qt,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(n),className:"space-y-4",children:[e.jsx(Ne,{control:r.control,name:"name",render:({field:i})=>e.jsxs(de,{children:[e.jsx(me,{children:"Room Name"}),e.jsx(ue,{children:e.jsx(k,{placeholder:"Enter room name...",...i,disabled:s.isPending})}),e.jsx(he,{children:"Choose a descriptive name for your room."}),e.jsx(xe,{})]})}),e.jsx(Ne,{control:r.control,name:"avatarUrl",render:({field:i})=>e.jsxs(de,{children:[e.jsx(me,{children:"Avatar URL (Optional)"}),e.jsx(ue,{children:e.jsx(k,{placeholder:"https://example.com/avatar.jpg",...i,disabled:s.isPending})}),e.jsx(he,{children:"Provide a URL for the room's avatar image."}),e.jsx(xe,{})]})}),e.jsxs(He,{children:[e.jsx(d,{type:"button",variant:"outline",onClick:o,disabled:s.isPending,children:"Cancel"}),e.jsx(d,{type:"submit",disabled:s.isPending,children:s.isPending?"Creating...":"Create Room"})]})]})})]})})}function Qt({room:a,isSelected:t,onClick:s}){const r=Ft(),n=o=>{o.stopPropagation(),r.mutate(a.id)};return e.jsxs("div",{onClick:s,className:`flex items-center gap-3 p-3 cursor-pointer transition-colors hover:bg-gray-100 ${t?"bg-blue-50 border-r-2 border-blue-500":""}`,children:[e.jsxs("div",{className:"relative",children:[e.jsxs(Z,{className:"w-10 h-10",children:[e.jsx(W,{src:a.avatarUrl}),e.jsx(Y,{children:e.jsx(Ls,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-green-500 border-2 border-white rounded-full"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-medium text-gray-900 truncate",children:a.name}),e.jsxs("div",{className:"flex items-center gap-1",children:[a.unreadCount&&a.unreadCount>0&&e.jsx(se,{variant:"destructive",className:"text-xs",children:a.unreadCount>99?"99+":a.unreadCount}),a.lastActivity&&e.jsx("span",{className:"text-xs text-gray-500",children:Be(new Date(a.lastActivity),{addSuffix:!0})})]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500",children:[e.jsx(pe,{className:"w-3 h-3"}),e.jsxs("span",{children:[a.participants.length," members"]})]}),!a.participants.includes("current-user-id")&&e.jsx(d,{size:"sm",variant:"outline",onClick:n,disabled:r.isPending,className:"h-6 px-2 text-xs",children:r.isPending?"Joining...":"Join"})]})]})]})}function Kt({onRoomSelect:a,selectedRoomId:t}){const[s,r]=c.useState(""),[n,o]=c.useState(!1),{rooms:i}=oe(),{data:l,isLoading:u,error:p}=Pt(),T=[...i.filter(v=>v.name.toLowerCase().includes(s.toLowerCase()))].sort((v,N)=>{const y=v.lastActivity?new Date(v.lastActivity).getTime():0;return(N.lastActivity?new Date(N.lastActivity).getTime():0)-y});return p?e.jsx("div",{className:"h-full flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-red-600 mb-2",children:"Failed to load rooms"}),e.jsx(d,{variant:"outline",onClick:()=>window.location.reload(),children:"Retry"})]})}):e.jsxs("div",{className:"h-full flex flex-col bg-white border-r",children:[e.jsxs("div",{className:"p-4 border-b",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Chat Rooms"}),e.jsx(d,{size:"sm",onClick:()=>o(!0),className:"h-8 w-8 p-0",children:e.jsx(Pe,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Ss,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search rooms...",value:s,onChange:v=>r(v.target.value),className:"w-full pl-9 pr-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:u?e.jsx("div",{className:"p-4 text-center text-gray-500",children:"Loading rooms..."}):T.length===0?e.jsxs("div",{className:"p-4 text-center text-gray-500",children:[s?"No rooms found":"No rooms available",!s&&e.jsx("div",{className:"mt-2",children:e.jsx(d,{variant:"outline",size:"sm",onClick:()=>o(!0),children:"Create your first room"})})]}):e.jsx("div",{className:"divide-y",children:T.map(v=>e.jsx(Qt,{room:v,isSelected:t===v.id,onClick:()=>a(v.id)},v.id))})}),e.jsx(zt,{open:n,onOpenChange:o})]})}function Ht({message:a,isOwn:t,showAvatar:s,onEdit:r,onDelete:n}){const[o,i]=c.useState(!1),[l,u]=c.useState(a.content),[p,f]=c.useState(!1),T=()=>{l.trim()&&l!==a.content&&r(a.id,l.trim()),i(!1)},v=y=>{y.key==="Enter"&&!y.shiftKey?(y.preventDefault(),T()):y.key==="Escape"&&(i(!1),u(a.content))},N=()=>{navigator.clipboard.writeText(a.content),f(!1)};return e.jsxs("div",{className:`flex gap-3 p-3 hover:bg-gray-50 group ${t?"flex-row-reverse":""}`,children:[s&&e.jsxs(Z,{className:"w-8 h-8 flex-shrink-0",children:[e.jsx(W,{src:a.author.avatarUrl}),e.jsx(Y,{children:a.author.username.charAt(0).toUpperCase()})]}),e.jsxs("div",{className:`flex-1 min-w-0 ${t?"text-right":""}`,children:[s&&e.jsxs("div",{className:`flex items-center gap-2 mb-1 ${t?"justify-end":""}`,children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:a.author.username}),e.jsx("span",{className:"text-xs text-gray-500",children:Be(new Date(a.createdAt),{addSuffix:!0})})]}),e.jsxs("div",{className:`relative ${t?"ml-8":"mr-8"}`,children:[o?e.jsxs("div",{className:"space-y-2",children:[e.jsx("textarea",{value:l,onChange:y=>u(y.target.value),onKeyDown:v,className:"w-full p-2 text-sm border rounded resize-none focus:outline-none focus:ring-2 focus:ring-blue-500",rows:Math.min(l.split(`
`).length,5),autoFocus:!0}),e.jsxs("div",{className:"flex gap-2 text-xs",children:[e.jsx(d,{size:"sm",onClick:T,children:"Save"}),e.jsx(d,{size:"sm",variant:"outline",onClick:()=>i(!1),children:"Cancel"})]})]}):e.jsxs("div",{className:`inline-block max-w-full p-3 rounded-lg text-sm break-words ${t?"bg-blue-500 text-white":"bg-gray-100 text-gray-900"} ${a.isOptimistic?"opacity-70":""} ${a.error?"bg-red-100 border border-red-300":""}`,children:[a.content,a.error&&e.jsxs("div",{className:"mt-1 text-xs text-red-600",children:["Failed to send: ",a.error]})]}),!o&&!a.isOptimistic&&e.jsx("div",{className:`absolute top-0 ${t?"left-0 -translate-x-full":"right-0 translate-x-full"} opacity-0 group-hover:opacity-100 transition-opacity`,children:e.jsxs("div",{className:"relative",children:[e.jsx(d,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0",onClick:()=>f(!p),children:e.jsx(Ps,{className:"w-3 h-3"})}),p&&e.jsxs("div",{className:`absolute top-full mt-1 bg-white border rounded-lg shadow-lg py-1 z-10 ${t?"right-0":"left-0"}`,children:[e.jsxs("button",{onClick:N,className:"flex items-center gap-2 px-3 py-1 text-sm hover:bg-gray-100 w-full text-left",children:[e.jsx(As,{className:"w-3 h-3"}),"Copy"]}),t&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>{i(!0),f(!1)},className:"flex items-center gap-2 px-3 py-1 text-sm hover:bg-gray-100 w-full text-left",children:[e.jsx(Ms,{className:"w-3 h-3"}),"Edit"]}),e.jsxs("button",{onClick:()=>{n(a.id),f(!1)},className:"flex items-center gap-2 px-3 py-1 text-sm hover:bg-gray-100 text-red-600 w-full text-left",children:[e.jsx(Ae,{className:"w-3 h-3"}),"Delete"]})]})]})]})})]})]})]})}function Jt({roomId:a,messages:t,isLoading:s,hasNextPage:r,onLoadMore:n}){const o=c.useRef(null),i=c.useRef(null),[l,u]=c.useState(!0),{user:p}=w(),{typingUsersByRoom:f}=oe(),T=Dt(a),v=Ut(a),N=f[a]||[];c.useEffect(()=>{l&&o.current&&o.current.scrollIntoView({behavior:"smooth"})},[t,l]);const y=()=>{if(!i.current)return;const{scrollTop:j,scrollHeight:C,clientHeight:L}=i.current,I=C-j-L<100;u(I),j===0&&r&&n&&n()},F=(j,C)=>{T.mutate({messageId:j,data:{content:C}})},V=j=>{v.mutate(j)};return s&&t.length===0?e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsx("div",{className:"text-gray-500",children:"Loading messages..."})}):e.jsx("div",{className:"flex-1 flex flex-col",children:e.jsxs("div",{ref:i,onScroll:y,className:"flex-1 overflow-y-auto",children:[r&&e.jsx("div",{className:"p-4 text-center",children:e.jsx(d,{variant:"outline",size:"sm",onClick:n,disabled:s,children:s?"Loading...":"Load more messages"})}),e.jsx("div",{className:"space-y-1",children:t.map((j,C)=>{const L=t[C-1],I=j.author.id===p?.id,_=!L||L.author.id!==j.author.id||new Date(j.createdAt).getTime()-new Date(L.createdAt).getTime()>5*60*1e3;return e.jsx(Ht,{message:j,isOwn:I,showAvatar:_,onEdit:F,onDelete:V},j.id)})}),N.length>0&&e.jsx("div",{className:"p-3 text-sm text-gray-500",children:N.length===1?e.jsxs("span",{children:[N[0].username," is typing..."]}):e.jsxs("span",{children:[N.map(j=>j.username).join(", ")," are typing..."]})}),e.jsx("div",{ref:o})]})})}function Vt({roomId:a,disabled:t=!1,placeholder:s="Type a message..."}){const[r,n]=c.useState(""),[o,i]=c.useState(!1),l=c.useRef(null),u=c.useRef(null),{sendMessage:p,setTyping:f}=oe(),T=y=>{y.preventDefault(),!(!r.trim()||t)&&(p(a,r.trim()),n(""),o&&(f(a,!1),i(!1)),l.current&&(l.current.style.height="auto"))},v=y=>{y.key==="Enter"&&!y.shiftKey&&(y.preventDefault(),T(y))},N=y=>{const F=y.target.value;n(F),l.current&&(l.current.style.height="auto",l.current.style.height=`${Math.min(l.current.scrollHeight,120)}px`),F.trim()&&!o&&(i(!0),f(a,!0)),u.current&&clearTimeout(u.current),F.trim()?u.current=window.setTimeout(()=>{i(!1),f(a,!1)},1e3):o&&(i(!1),f(a,!1))};return c.useEffect(()=>()=>{u.current&&clearTimeout(u.current),o&&f(a,!1)},[a,o,f]),e.jsxs("div",{className:"border-t bg-white p-4",children:[e.jsxs("form",{onSubmit:T,className:"flex items-end gap-2",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("textarea",{ref:l,value:r,onChange:N,onKeyDown:v,placeholder:s,disabled:t,className:"w-full resize-none rounded-lg border border-gray-300 px-3 py-2 pr-10 text-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 disabled:bg-gray-100 disabled:cursor-not-allowed",style:{minHeight:"40px",maxHeight:"120px"},rows:1}),e.jsx("button",{type:"button",className:"absolute right-2 top-1/2 -translate-y-1/2 p-1 text-gray-400 hover:text-gray-600 transition-colors",disabled:t,children:e.jsx(Fs,{className:"w-4 h-4"})})]}),e.jsxs(d,{type:"submit",size:"sm",disabled:!r.trim()||t,className:"h-10 px-3",children:[e.jsx(Es,{className:"w-4 h-4"}),e.jsx("span",{className:"sr-only",children:"Send message"})]})]}),r.length>1800&&e.jsxs("div",{className:"mt-1 text-xs text-gray-500 text-right",children:[r.length,"/2000"]})]})}function Ze({roomId:a}){const{setCurrentRoom:t,joinRoom:s,messagesByRoom:r,typingUsersByRoom:n,isConnected:o}=oe(),{connected:i}=ye(),{data:l,isLoading:u,error:p}=At(a),{data:f,isLoading:T,hasNextPage:v,fetchNextPage:N,isFetchingNextPage:y}=Et(a);$t(a);const F=r[a]||[],V=f?.pages.flatMap(C=>C.messages)||[],j=[...F,...V].filter((C,L,I)=>I.findIndex(_=>_.id===C.id)===L).sort((C,L)=>new Date(L.createdAt).getTime()-new Date(C.createdAt).getTime());return c.useEffect(()=>(t(a),i&&s(a),()=>{t(null)}),[a,i,t,s]),p?e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-red-600 mb-2",children:"Failed to load room"}),e.jsx(d,{variant:"outline",onClick:()=>window.location.reload(),children:"Retry"})]})}):u?e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsx("div",{className:"text-gray-500",children:"Loading room..."})}):l?(n[a],e.jsxs("div",{className:"h-full flex flex-col bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(Z,{className:"w-10 h-10",children:[e.jsx(W,{src:l.avatarUrl}),e.jsx(Y,{children:l.name.charAt(0).toUpperCase()})]}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-semibold text-gray-900",children:l.name}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[e.jsx(pe,{className:"w-4 h-4"}),e.jsxs("span",{children:[l.participants.length," members"]}),!i&&e.jsx(se,{variant:"destructive",className:"text-xs",children:"Disconnected"}),i&&e.jsx(se,{variant:"secondary",className:"text-xs",children:"Online"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{size:"sm",variant:"ghost",className:"h-8 w-8 p-0",children:e.jsx(Ds,{className:"w-4 h-4"})}),e.jsx(d,{size:"sm",variant:"ghost",className:"h-8 w-8 p-0",children:e.jsx(Us,{className:"w-4 h-4"})}),e.jsx(d,{size:"sm",variant:"ghost",className:"h-8 w-8 p-0",children:e.jsx($s,{className:"w-4 h-4"})})]})]}),!i&&e.jsx("div",{className:"bg-yellow-50 border-b border-yellow-200 px-4 py-2",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-yellow-800",children:[e.jsx("div",{className:"w-2 h-2 bg-yellow-500 rounded-full animate-pulse"}),e.jsx("span",{children:"Reconnecting to chat..."})]})}),e.jsx(Jt,{roomId:a,messages:j,isLoading:T||y,hasNextPage:v,onLoadMore:()=>N()}),e.jsx(Vt,{roomId:a,disabled:!i,placeholder:i?"Type a message...":"Connecting to chat..."})]})):e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsx("div",{className:"text-gray-500",children:"Room not found"})})}const _t=B("/chat")({beforeLoad:({location:a})=>{if(!w.getState().isAuthenticated)throw ae({to:"/login",search:{redirect:a.href}})},component:Gt});function Gt(){const[a,t]=c.useState(null),s=fe();ye();const r=n=>{t(n),s({to:"/room/$id",params:{id:n}}).catch(()=>{t(n)})};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(H,{title:"Chat"}),e.jsxs("div",{className:"h-[calc(100vh-4rem)] flex",children:[e.jsx("div",{className:"w-80 flex-shrink-0",children:e.jsx(Kt,{onRoomSelect:r,selectedRoomId:a||void 0})}),e.jsx("div",{className:"flex-1",children:a?e.jsx(Ze,{roomId:a}):e.jsx("div",{className:"h-full flex items-center justify-center bg-white",children:e.jsxs("div",{className:"text-center text-gray-500",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})})}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Select a room to start chatting"}),e.jsx("p",{className:"text-sm",children:"Choose a room from the sidebar to begin your conversation"})]})})})]})]})}const Zt=B("/404")({component:Wt});function Wt(){return e.jsxs("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 relative",children:[e.jsx(m,{to:"/",className:"absolute top-4 left-4",children:e.jsxs(d,{variant:"ghost",size:"sm",children:[e.jsx(Q,{className:"w-4 h-4 mr-2"}),"Back to Home"]})}),e.jsxs("div",{className:"max-w-md mx-auto text-center",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("div",{className:"text-8xl mb-4",children:"🔍"}),e.jsx("h1",{className:"text-6xl font-bold text-gray-900 mb-4",children:"404"}),e.jsx("h2",{className:"text-2xl font-semibold text-gray-700 mb-2",children:"Page Not Found"}),e.jsx("p",{className:"text-gray-600 mb-8",children:"Oops! The page you're looking for doesn't exist. It might have been moved, deleted, or you entered the wrong URL."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(m,{to:"/",children:e.jsxs(d,{className:"w-full",children:[e.jsx(Se,{className:"w-4 h-4 mr-2"}),"Go to Homepage"]})}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(m,{to:"/todo",className:"flex-1",children:e.jsx(d,{variant:"outline",className:"w-full",children:"Todo App"})}),e.jsx(m,{to:"/chat",className:"flex-1",children:e.jsx(d,{variant:"outline",className:"w-full",children:"Chat Rooms"})})]})]})]})]})}const Yt=B("/")({component:Xt});function Xt(){const{isAuthenticated:a}=w(),t=[{icon:e.jsx(Os,{className:"w-8 h-8"}),title:"Modern Tech Stack",description:"Built with React, TypeScript, TanStack Router, and TailwindCSS",color:"bg-blue-500"},{icon:e.jsx(Bs,{className:"w-8 h-8"}),title:"Full Stack Ready",description:"Complete MERN stack with MongoDB, Express, React, and Node.js",color:"bg-green-500"},{icon:e.jsx(qs,{className:"w-8 h-8"}),title:"High Performance",description:"Optimized for speed with modern bundling and state management",color:"bg-yellow-500"},{icon:e.jsx(Is,{className:"w-8 h-8"}),title:"Responsive Design",description:"Beautiful UI that works perfectly on all devices",color:"bg-purple-500"}],s=[{title:"Todo Manager",description:"Organize your tasks efficiently with our intuitive todo application",icon:e.jsx(zs,{className:"w-6 h-6"}),link:"/todo",color:"from-blue-500 to-blue-600"},{title:"Chat Rooms",description:"Connect with others in real-time chat rooms",icon:e.jsx(Qs,{className:"w-6 h-6"}),link:"/chat",color:"from-green-500 to-green-600"},{title:"User Profile",description:"Manage your account settings and preferences",icon:e.jsx(pe,{className:"w-6 h-6"}),link:"/profile",color:"from-purple-500 to-purple-600"}];return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100",children:[e.jsx(H,{transparent:!0}),e.jsx("div",{className:"relative overflow-hidden",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-24",children:e.jsxs("div",{className:"text-center",children:[e.jsx(se,{variant:"secondary",className:"mb-4",children:"🚀 Modern Full Stack Application"}),e.jsxs("h1",{className:"text-4xl md:text-6xl font-bold text-gray-900 mb-6",children:["Welcome to"," ",e.jsx("span",{className:"bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"MERN Stack"})]}),e.jsx("p",{className:"text-xl text-gray-600 mb-8 max-w-3xl mx-auto",children:"A modern, full-featured web application built with the latest technologies. Experience the power of React, TanStack Router, shadcn/ui, and TailwindCSS."}),e.jsx("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:a?e.jsxs(e.Fragment,{children:[e.jsx(m,{to:"/todo",children:e.jsxs(d,{size:"lg",className:"w-full sm:w-auto",children:["Try Todo App",e.jsx(ce,{className:"ml-2 w-4 h-4"})]})}),e.jsx(m,{to:"/chat",children:e.jsx(d,{variant:"outline",size:"lg",className:"w-full sm:w-auto",children:"Join Chat Rooms"})})]}):e.jsxs(e.Fragment,{children:[e.jsx(m,{search:{redirect:"/todo"},to:"/login",children:e.jsxs(d,{size:"lg",className:"w-full sm:w-auto",children:["Sign In to Get Started",e.jsx(ce,{className:"ml-2 w-4 h-4"})]})}),e.jsx(m,{to:"/register",children:e.jsx(d,{variant:"outline",size:"lg",className:"w-full sm:w-auto",children:"Create Account"})})]})}),!a&&e.jsxs("div",{className:"mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg max-w-md mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-2 text-blue-800",children:[e.jsx(ve,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Authentication Required"})]}),e.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"Sign in to access Todo Manager, Chat Rooms, and Profile features."})]})]})})}),e.jsx("div",{className:"py-24 bg-white",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"text-center mb-16",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Built with Modern Technologies"}),e.jsx("p",{className:"text-lg text-gray-600 max-w-2xl mx-auto",children:"Our application leverages the latest and greatest technologies to provide you with the best possible experience."})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8",children:t.map((r,n)=>e.jsxs(P,{className:"text-center hover:shadow-lg transition-shadow",children:[e.jsxs(U,{children:[e.jsx("div",{className:`w-16 h-16 ${r.color} rounded-lg flex items-center justify-center text-white mx-auto mb-4`,children:r.icon}),e.jsx($,{className:"text-lg",children:r.title})]}),e.jsx(A,{children:e.jsx(z,{children:r.description})})]},n))})]})}),e.jsx("div",{className:"py-24 bg-gray-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"text-center mb-16",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Explore Our Applications"}),e.jsx("p",{className:"text-lg text-gray-600 max-w-2xl mx-auto",children:"Discover the powerful applications we've built to showcase the capabilities of our modern tech stack."})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:s.map((r,n)=>e.jsxs(P,{className:"hover:shadow-lg transition-all duration-300 hover:-translate-y-1",children:[e.jsxs(U,{children:[e.jsx("div",{className:`w-12 h-12 bg-gradient-to-r ${r.color} rounded-lg flex items-center justify-center text-white mb-4`,children:r.icon}),e.jsx($,{className:"text-xl",children:r.title}),e.jsx(z,{children:r.description})]}),e.jsx(A,{children:a?e.jsx(m,{to:r.link,children:e.jsxs(d,{className:"w-full",children:["Try it now",e.jsx(ce,{className:"ml-2 w-4 h-4"})]})}):e.jsx(m,{search:{redirect:r.link},to:"/login",children:e.jsxs(d,{variant:"outline",className:"w-full",children:[e.jsx(ve,{className:"w-4 h-4 mr-2"}),"Sign in to access"]})})})]},n))})]})}),e.jsx("footer",{className:"bg-gray-900 text-white py-12",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-8",children:[e.jsxs("div",{className:"col-span-1 md:col-span-2",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-sm",children:"MS"})}),e.jsx("span",{className:"ml-3 text-xl font-semibold",children:"MERN Stack"})]}),e.jsx("p",{className:"text-gray-400 mb-4",children:"A modern full-stack application showcasing the power of React, TanStack Router, and modern web technologies."})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Applications"}),e.jsxs("ul",{className:"space-y-2",children:[e.jsx("li",{children:e.jsx(m,{to:"/todo",className:"text-gray-400 hover:text-white",children:"Todo Manager"})}),e.jsx("li",{children:e.jsx(m,{to:"/chat",className:"text-gray-400 hover:text-white",children:"Chat Rooms"})}),e.jsx("li",{children:e.jsx(m,{to:"/profile",className:"text-gray-400 hover:text-white",children:"User Profile"})})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Account"}),e.jsxs("ul",{className:"space-y-2",children:[e.jsx("li",{children:e.jsx(m,{to:"/login",className:"text-gray-400 hover:text-white",search:{redirect:"/todo"},children:"Sign In"})}),e.jsx("li",{children:e.jsx(m,{to:"/register",className:"text-gray-400 hover:text-white",children:"Sign Up"})}),e.jsx("li",{children:e.jsx(m,{to:"/forgot-password",className:"text-gray-400 hover:text-white",children:"Forgot Password"})})]})]})]}),e.jsx("div",{className:"border-t border-gray-800 mt-8 pt-8 text-center",children:e.jsx("p",{className:"text-gray-400",children:"© 2025 MERN Stack App. Built with ❤️ using modern web technologies."})})]})})]})}const ea=B("/room/$id")({beforeLoad:({location:a})=>{if(!w.getState().isAuthenticated)throw ae({to:"/login",search:{redirect:a.href}})},component:sa});function sa(){const{id:a}=Ks({from:"/room/$id"});return ye(),e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b px-4 py-3 sticky top-0 z-50",children:e.jsxs("div",{className:"max-w-4xl mx-auto flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center space-x-3",children:e.jsx(m,{to:"/chat",children:e.jsxs(d,{variant:"ghost",size:"sm",children:[e.jsx(Q,{className:"w-4 h-4 mr-2"}),"Back to Chat"]})})}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(m,{to:"/",children:e.jsx(d,{variant:"outline",size:"sm",children:"Home"})})})]})}),e.jsx("div",{className:"h-[calc(100vh-4rem)]",children:e.jsx(Ze,{roomId:a})})]})}const ta=et.update({id:"/verify-otp",path:"/verify-otp",getParentRoute:()=>O}),aa=pt.update({id:"/todo",path:"/todo",getParentRoute:()=>O}),ra=jt.update({id:"/register",path:"/register",getParentRoute:()=>O}),na=Nt.update({id:"/profile",path:"/profile",getParentRoute:()=>O}),oa=bt.update({id:"/login",path:"/login",getParentRoute:()=>O}),ia=Tt.update({id:"/forgot-password",path:"/forgot-password",getParentRoute:()=>O}),la=_t.update({id:"/chat",path:"/chat",getParentRoute:()=>O}),ca=Zt.update({id:"/404",path:"/404",getParentRoute:()=>O}),da=Yt.update({id:"/",path:"/",getParentRoute:()=>O}),ma=ea.update({id:"/room/$id",path:"/room/$id",getParentRoute:()=>O}),ua={IndexRoute:da,R404Route:ca,ChatRoute:la,ForgotPasswordRoute:ia,LoginRoute:oa,ProfileRoute:na,RegisterRoute:ra,TodoRoute:aa,VerifyOtpRoute:ta,RoomIdRoute:ma},ha=O._addFileChildren(ua)._addFileTypes(),xa=new Hs({defaultOptions:{queries:{staleTime:60*1e3,gcTime:10*60*1e3,retry:(a,t)=>t?.status>=400&&t?.status<500&&![408,429].includes(t?.status)?!1:a<3,refetchOnWindowFocus:!1},mutations:{retry:(a,t)=>t?.status>=400&&t?.status<500&&![408,429].includes(t?.status)?!1:a<2}}}),ga=Js({routeTree:ha}),we=document.getElementById("root");we.innerHTML||Vs.createRoot(we).render(e.jsx(c.StrictMode,{children:e.jsxs(_s,{client:xa,children:[e.jsx(Gs,{router:ga}),e.jsx(Zs,{initialIsOpen:!1})]})}));
